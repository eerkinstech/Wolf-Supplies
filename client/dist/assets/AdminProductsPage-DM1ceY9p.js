import{j as e}from"./editor-BiSlXHWs.js";import{u as t,a}from"./vendor-0z5P9xg-.js";import{A as s}from"./AdminLayout-Cnhsu9ug.js";import{f as r,z as i}from"./index-BiO51Ilc.js";import{u as n,d as o}from"./redux-DhaBhdiE.js";const c="https://api.wolfsupplies.co.uk",l=()=>{const s=n(),l=t(),{products:d=[],loading:m}=o(e=>e.product),[p,g]=a.useState([]),[u,x]=a.useState("active"),[h,f]=a.useState(""),[y,b]=a.useState(new Set);a.useEffect(()=>{s(r())},[s]),a.useEffect(()=>{g(d||[])},[d]);const v=(d||[]).filter(e=>!e.isDraft).length,j=(d||[]).filter(e=>e.isDraft).length,N=(d||[]).length,w=(p||[]).filter(e=>{const t="all"===u||("active"===u?!e.isDraft:Boolean(e.isDraft)),a=""===h.trim()||e.name&&e.name.toLowerCase().includes(h.toLowerCase());return t&&a}),C=e=>{if(!e.variantCombinations||0===e.variantCombinations.length)return`Â£${e.price?.toFixed(2)||"0.00"}`;const t=e.variantCombinations.map(t=>t.price||e.price);return`From Â£${Math.min(...t).toFixed(2)}`},k=e=>e.variantCombinations&&0!==e.variantCombinations.length?e.variantCombinations.reduce((e,t)=>e+(t.stock||0),0):e.stock||0,$=e=>e.variantCombinations&&e.variantCombinations.length>0;return e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Product Management"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold transition duration-300 cursor-pointer",children:["ðŸ“¥ Import Products",e.jsx("input",{type:"file",accept:".csv",onChange:async e=>{const t=e.target.files?.[0];if(t)if(t.name.endsWith(".csv"))try{const n=(await t.text()).trim().split("\n");if(n.length<2)return void i.error("CSV file must have headers and at least one product row");const o=e=>{const t=[];let a="",s=!1;for(let r=0;r<e.length;r++){const i=e[r],n=e[r+1];'"'===i?s&&'"'===n?(a+='"',r++):s=!s:","!==i||s?a+=i:(t.push(a.trim()),a="")}return t.push(a.trim()),t},l=e=>e.toLowerCase().replace(/\s+/g," ").trim(),d=o(n[0]),m=d.map(l),p=m.some(e=>e.includes("name")),g=m.some(e=>e.includes("price"));if(!p||!g)return void i.error(`CSV must include at least: Name, Price\nFound headers: ${d.join(", ")}`);const u=[];for(let e=1;e<n.length;e++){const t=n[e].trim();if(!t)continue;const s=o(t),r={};m.forEach((e,t)=>{r[e]=s[t]||""});const i=e=>{const t=l(e);return Object.entries(r).find(([e])=>l(e)===t)?.[1]||""},c=i("category"),d=c&&c.trim()?c.split("|").map(e=>e.trim()).filter(Boolean):[],p={name:i("name"),slug:i("slug")||i("name")?.toLowerCase().replace(/\s+/g,"-"),description:i("description"),price:parseFloat(i("base price")||i("price"))||0,originalPrice:parseFloat(i("original price"))||null,discount:parseFloat(i("discount"))||0,stock:parseInt(i("base stock")||i("stock"))||0,categories:d.length>0?d:[],isDraft:"draft"===i("status")?.toLowerCase(),rating:parseFloat(i("rating"))||0,numReviews:parseInt(i("number of reviews"))||0,metaTitle:i("meta title"),metaDescription:i("meta description"),metaKeywords:i("meta keywords"),benefitsHeading:i("benefits heading")||"Why Buy This Product",benefits:i("benefits"),sku:i("sku"),images:i("images")?i("images").split("|").map(e=>e.trim()).filter(Boolean):[]},g=i("variants"),x=i("variant combinations"),h=i("variants json"),f=i("variant type"),y=i("variant values");if(g&&g.trim())try{const e=JSON.parse(g);Array.isArray(e)&&(p.variants=e)}catch(a){}else if(h&&h.trim())try{const e=JSON.parse(h);e.variants&&Array.isArray(e.variants)&&(p.variants=e.variants),e.variantCombinations&&Array.isArray(e.variantCombinations)&&(p.variantCombinations=e.variantCombinations)}catch(a){}else if(f&&y)try{const e=f.split("|").map(e=>e.trim()),t=y.split("|").map(e=>e.trim()),a={};t.forEach(e=>{const[t,s]=e.split(":").map(e=>e.trim());t&&s&&(a[t]=s)}),p.variants=e.map(e=>({name:e,values:[]})),p.variantCombinations=[{variantValues:a,sku:i("sku")||"",price:parseFloat(i("variant price"))||parseFloat(i("price"))||0,stock:parseInt(i("variant stock"))||parseInt(i("stock"))||0,image:i("variant image")||i("images")?.split("|")[0]||""}]}catch(a){}if(x&&x.trim())try{const e=JSON.parse(x);e&&e.variantValues&&(p.variantCombinations||(p.variantCombinations=[]),p.variantCombinations.push({variantValues:e.variantValues,sku:e.sku||"",price:parseFloat(e.price)||p.price||0,stock:parseInt(e.stock)||0,image:e.image||""}))}catch(a){}u.push(p)}if(0===u.length)return void i.error("No valid products found in CSV");const x=localStorage.getItem("token"),h=await fetch(`${c}/api/products/import`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify({products:u})});if(!h.ok){const e=await h.json();throw new Error(e.message||"Failed to import products")}i.success(`Successfully imported ${u.length} product(s)`),s(r()),e.target.value=""}catch(n){i.error(n.message||"Failed to import products")}else i.error("Please upload a valid CSV file")},className:"hidden"})]}),e.jsxs("button",{onClick:()=>l("/admin/products/add"),className:"flex items-center gap-2 bg-gray-800 hover:bg-black text-white px-6 py-2 rounded-lg font-semibold transition duration-300",children:[e.jsx("i",{className:"fas fa-plus"})," Add Product"]})]})]}),e.jsxs("div",{className:"mb-6 flex items-center gap-4 justify-between flex-wrap",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>x("all"),className:"px-4 py-2 rounded-lg font-semibold "+("all"===u?"bg-gray-800 text-white":"bg-gray-100 text-gray-700"),children:["All (",N,")"]}),e.jsxs("button",{onClick:()=>x("active"),className:"px-4 py-2 rounded-lg font-semibold "+("active"===u?"bg-gray-800 text-white":"bg-gray-100 text-gray-700"),children:["Active (",v,")"]}),e.jsxs("button",{onClick:()=>x("draft"),className:"px-4 py-2 rounded-lg font-semibold "+("draft"===u?"bg-gray-800 text-white":"bg-gray-100 text-gray-700"),children:["Drafts (",j,")"]})]}),e.jsxs("div",{className:"relative w-80",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400",children:e.jsx("i",{className:"fas fa-search text-sm"})}),e.jsx("input",{type:"text",placeholder:"Search products by name...",value:h,onChange:e=>f(e.target.value),className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 focus:border-transparent outline-none transition"}),h&&e.jsx("button",{onClick:()=>f(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition","aria-label":"Clear search",children:e.jsx("i",{className:"fas fa-times text-sm"})})]})]}),w.some(e=>e.selected)&&e.jsxs("div",{className:"mb-6 bg-gray-100 border border-gray-300 rounded-lg p-4 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:[w.filter(e=>e.selected).length," product(s) selected"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>(()=>{const e=w.filter(e=>e.selected);if(0!==e.length)try{const t=["Product ID","Name","Slug","Description","Base Price","Original Price","Discount (%)","Base Stock","Category","Status","Rating","Number of Reviews","Images","Meta Title","Meta Description","Meta Keywords","Benefits Heading","Benefits","SKU","Variants","Variant Combinations","Created Date","Updated Date"],a=[];e.forEach(e=>{const t=e.images&&e.images.length>0?e.images.join(" | "):"";let s="";e.categories&&e.categories.length>0?s=e.categories.map(e=>"string"==typeof e?e:e.name?e.name:"").filter(Boolean).join(" | "):e.category&&(s="string"==typeof e.category?e.category:e.category.name||"");let r=[];e.variants&&e.variants.length>0&&(r=e.variants.map(t=>{const a=new Set;return e.variantCombinations&&e.variantCombinations.forEach(e=>{e.variantValues&&e.variantValues[t.name]&&a.add(e.variantValues[t.name])}),{name:t.name,values:Array.from(a)}}));const i=JSON.stringify(r).replace(/"/g,'""');if(e.variantCombinations&&e.variantCombinations.length>0)e.variantCombinations.forEach(r=>{const n=JSON.stringify(r).replace(/"/g,'""'),o=[e._id||"",`"${(e.name||"").replace(/"/g,'""')}"`,e.slug||"",`"${(e.description||"").replace(/"/g,'""')}"`,e.price||"0",e.originalPrice||"",e.discount||"0",e.stock||"0",`"${s}"`,e.isDraft?"Draft":"Active",e.rating||"0",e.numReviews||"0",`"${t}"`,`"${(e.metaTitle||"").replace(/"/g,'""')}"`,`"${(e.metaDescription||"").replace(/"/g,'""')}"`,`"${(e.metaKeywords||"").replace(/"/g,'""')}"`,`"${(e.benefitsHeading||"Why Buy This Product").replace(/"/g,'""')}"`,`"${(e.benefits||"").replace(/"/g,'""').replace(/\n/g," ")}"`,e.sku||"",`"${i}"`,`"${n}"`,e.createdAt?new Date(e.createdAt).toLocaleString():"",e.updatedAt?new Date(e.updatedAt).toLocaleString():""];a.push(o)});else{const r=[e._id||"",`"${(e.name||"").replace(/"/g,'""')}"`,e.slug||"",`"${(e.description||"").replace(/"/g,'""')}"`,e.price||"0",e.originalPrice||"",e.discount||"0",e.stock||"0",`"${s}"`,e.isDraft?"Draft":"Active",e.rating||"0",e.numReviews||"0",`"${t}"`,`"${(e.metaTitle||"").replace(/"/g,'""')}"`,`"${(e.metaDescription||"").replace(/"/g,'""')}"`,`"${(e.metaKeywords||"").replace(/"/g,'""')}"`,`"${(e.benefitsHeading||"Why Buy This Product").replace(/"/g,'""')}"`,`"${(e.benefits||"").replace(/"/g,'""').replace(/\n/g," ")}"`,e.sku||"",`"${i}"`,"",e.createdAt?new Date(e.createdAt).toLocaleString():"",e.updatedAt?new Date(e.updatedAt).toLocaleString():""];a.push(r)}});const s=[t.join(","),...a.map(e=>e.join(","))].join("\n"),r=new Blob([s],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download=`products_export_${(new Date).getTime()}.csv`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n),i.success(`Exported ${e.length} product(s) to CSV successfully`)}catch(t){i.error("Failed to export products")}else i.error("No products selected to export")})(),className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg text-sm font-semibold transition",title:"Export selected products as JSON",children:"ðŸ“¥ Export"}),e.jsx("button",{onClick:()=>{w.filter(e=>e.selected).map(e=>e._id).forEach(e=>(async e=>{try{const t=localStorage.getItem("token"),a=p.find(t=>t._id===e);if(!a)return;const n=!a.isDraft;if(!(await fetch(`${c}/api/products/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({isDraft:n})})).ok)throw new Error("Failed to update product");i.success(n?"Moved to drafts":"Published successfully"),s(r())}catch(t){i.error(t.message)}})(e))},className:"px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg text-sm font-semibold transition",children:"active"===u?"Move to Draft":"Publish"}),e.jsx("button",{onClick:()=>{(async e=>{if(window.confirm(`Delete ${e.length} product(s)? This cannot be undone.`))try{const t=localStorage.getItem("token"),a=e.map(e=>fetch(`${c}/api/products/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})),n=(await Promise.all(a)).filter(e=>!e.ok).length,o=e.length-n;o>0&&i.success(`Deleted ${o} product(s)`),n>0&&i.error(`Failed to delete ${n} product(s)`),s(r())}catch(t){i.error("Error deleting products: "+t.message)}})(w.filter(e=>e.selected).map(e=>e._id))},className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-semibold transition",children:"Delete Selected"}),e.jsx("button",{onClick:()=>g(p.map(e=>({...e,selected:!1}))),className:"px-4 py-2 bg-gray-300 hover:bg-black text-gray-900 rounded-lg text-sm font-semibold transition",children:"Clear Selection"})]})]}),m&&e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner animate-spin text-4xl text-gray-700"})}),!m&&e.jsx("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-center w-10",children:e.jsx("input",{type:"checkbox",checked:p.length>0&&p.every(e=>e.selected),onChange:e=>g(p.map(t=>({...t,selected:e.target.checked}))),className:"w-4 h-4 cursor-pointer"})}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Price"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Stock"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:w&&w.length>0?w.map(t=>{const a=t.images&&t.images.length>0?t.images[0]:t.image||"",n=a?a.startsWith("http")?a:`${c}${a}`:null;return e.jsxs("tr",{className:"hover:bg-gray-50 transition duration-300",children:[e.jsx("td",{className:"px-4 py-4 text-center",children:e.jsx("input",{type:"checkbox",checked:t.selected||!1,onChange:e=>g(p.map(a=>a._id===t._id?{...a,selected:e.target.checked}:a)),className:"w-4 h-4 cursor-pointer"})}),e.jsx("td",{className:"px-6 py-4 w-96 text-sm text-gray-900 font-semibold",children:e.jsxs("div",{className:"flex items-center",children:[n&&!y.has(t._id)?e.jsx("img",{src:n,alt:t.name,loading:"lazy",className:"w-12 h-12 rounded-md object-cover mr-4",onError:e=>{e.target.style.display="none",b(e=>new Set([...e,t._id]))}}):e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-md mr-4 flex items-center justify-center text-center text-xs font-semibold text-gray-600",children:"No Image"}),e.jsxs("div",{className:" w-64 flex items-center gap-2",children:[e.jsx("span",{className:"",children:t.name}),t.isDraft&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-yellow-100 text-yellow-800",children:"Draft"}),!t.isDraft&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-gray-100 text-gray-800",children:"Active"})]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-700 font-bold",children:C(t)}),$(t)&&e.jsxs("div",{className:"text-xs text-gray-900 mt-1",children:[t.variantCombinations.length," variants"]})]})}),e.jsxs("td",{className:"px-6 text-sm py-4",children:[e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-semibold "+(k(t)>0?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"),children:k(t)}),$(t)&&e.jsx("span",{className:"text-xs ml-3 text-gray-900 mt-1",children:"Total stock"})]}),e.jsxs("td",{className:"px-6 py-4 text-center space-x-3",children:[e.jsx("button",{onClick:()=>((e=null)=>{e&&e._id?l(`/admin/products/edit/${e._id}`):l("/admin/products/add")})(t),className:"text-gray-700 hover:text-gray-800 transition",children:e.jsx("i",{className:"fas fa-edit"})}),e.jsx("button",{onClick:()=>(async(e,t=!1)=>{try{const a=localStorage.getItem("token");if(!(await fetch(`${c}/api/products/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}})).ok)throw new Error("Failed to delete product");return t||(i.success("Product deleted successfully"),s(r())),!0}catch(a){return t||i.error(a.message),!1}})(t._id),className:"text-red-600 hover:text-red-800 transition",children:e.jsx("i",{className:"fas fa-trash"})})]})]},t._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-6 py-8 text-center text-gray-600",children:"No products found"})})})]})})]})},d=()=>e.jsx(s,{activeTab:"products",children:e.jsx(l,{})});export{d as default};
