import{j as e}from"./editor-BiSlXHWs.js";import{a as t}from"./vendor-0z5P9xg-.js";import{z as r}from"./index-BiO51Ilc.js";import{A as s}from"./AdminLayout-Cnhsu9ug.js";import"./redux-DhaBhdiE.js";const o=()=>{const[o,a]=t.useState([]),[l,c]=t.useState(null),[i,n]=t.useState(""),[d,m]=t.useState(!0),[x,h]=t.useState(!1),[p,u]=t.useState(""),[f,b]=t.useState({}),[g,v]=t.useState({}),[y,j]=t.useState("chat"),[N,w]=t.useState([]),[C,S]=t.useState([]),k=t.useRef(null),_=t.useRef(!0),E="https://api.wolfsupplies.co.uk",z=localStorage.getItem("adminName")||"Admin";t.useEffect(()=>{F();const e=setInterval(()=>{F(),l&&A(l)},2e3);return()=>clearInterval(e)},[l]),t.useEffect(()=>{"chat"===y?F():"contact"===y?$():"newsletter"===y&&L()},[y]),t.useEffect(()=>{k.current?.scrollIntoView({behavior:"smooth"})},[l?.messages]);const F=async()=>{try{const e=localStorage.getItem("token"),t=await fetch(`${E}/api/forms/contact?limit=100&status=all`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch conversations");const r=((await t.json()).data||[]).filter(e=>{const t=e.messages||[],r=t.filter(e=>e.subject&&"Chat Support"!==e.subject).length,s=t.filter(e=>!e.subject||"Chat Support"===e.subject).length;return!1===e.fromContactForm||(r>0&&s>0||s>0&&0===r)});a(r),m(!1);const s={};r.forEach(e=>{const t=(e.messages||[]).filter(e=>"user"===e.sender&&!e.isRead).length;t>0&&(s[e._id]=t)}),b(s),_.current&&!l&&r&&r.length>0&&(c(r[0]),A(r[0]),_.current=!1)}catch(e){r.error("Failed to load conversations"),m(!1)}},A=async e=>{if(e&&e._id)try{const t=localStorage.getItem("token"),r=await fetch(`${E}/api/forms/contact/${e._id}`,{headers:{Authorization:`Bearer ${t}`}});if(!r.ok)throw new Error("Failed to fetch conversation");const s=await r.json();c(s.data);const o=(s.data.messages||[]).filter(e=>"user"===e.sender&&!e.isRead).length;b(t=>{const r={...t};return 0===o?delete r[e._id]:r[e._id]=o,r})}catch(t){r.error("Failed to load conversation")}},$=async()=>{try{const e=localStorage.getItem("token"),t=await fetch(`${E}/api/forms/contact?limit=100&status=all`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch contact submissions");const r=((await t.json()).data||[]).filter(e=>(e.messages||[]).filter(e=>e.subject&&"Chat Support"!==e.subject).length>0||(e.fromContactForm,!1));w(r)}catch(e){r.error("Failed to load contact submissions")}},L=async()=>{try{const e=localStorage.getItem("token"),t=await fetch(`${E}/api/newsletter?limit=100`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch newsletter subscriptions");const r=await t.json();S(r.data||[])}catch(e){r.error("Failed to load newsletter subscriptions")}},M=o.filter(e=>e.userEmail&&e.userEmail.toLowerCase().includes(p.toLowerCase())||e.userName&&e.userName.toLowerCase().includes(p.toLowerCase())),B=e=>{const t=new Date(e);return(new Date-t)/36e5<24?t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric"})};return d?e.jsx(s,{activeTab:"chat",children:e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading conversations..."})]})})}):e.jsx(s,{activeTab:"chat",children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-64px)]",style:{backgroundColor:"var(--color-bg-primary)"},children:[e.jsxs("div",{className:"flex border-b",style:{borderColor:"var(--color-border-light)",backgroundColor:"var(--color-bg-section)"},children:[e.jsxs("button",{onClick:()=>j("chat"),className:"flex items-center gap-2 px-6 py-4 font-semibold transition "+("chat"===y?"border-b-2":""),style:{color:"chat"===y?"var(--color-accent-primary)":"var(--color-text-light)",borderBottomColor:"chat"===y?"var(--color-accent-primary)":"transparent"},children:[e.jsx("i",{className:"fas fa-comments",style:{fontSize:"18px"}}),"Chat"]}),e.jsxs("button",{onClick:()=>j("contact"),className:"flex items-center gap-2 px-6 py-4 font-semibold transition "+("contact"===y?"border-b-2":""),style:{color:"contact"===y?"var(--color-accent-primary)":"var(--color-text-light)",borderBottomColor:"contact"===y?"var(--color-accent-primary)":"transparent"},children:[e.jsx("i",{className:"fas fa-envelope",style:{fontSize:"18px"}}),"Contact"]}),e.jsxs("button",{onClick:()=>j("newsletter"),className:"flex items-center gap-2 px-6 py-4 font-semibold transition "+("newsletter"===y?"border-b-2":""),style:{color:"newsletter"===y?"var(--color-accent-primary)":"var(--color-text-light)",borderBottomColor:"newsletter"===y?"var(--color-accent-primary)":"transparent"},children:[e.jsx("i",{className:"fas fa-bullhorn",style:{fontSize:"18px"}}),"Newsletter"]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:["chat"===y&&e.jsxs("div",{className:"flex w-full overflow-hidden",children:[e.jsxs("div",{className:"w-80",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border-light)",borderRightWidth:"1px"},children:[e.jsxs("div",{className:"p-4",style:{borderColor:"var(--color-border-light)",borderBottomWidth:"1px"},children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",style:{color:"var(--color-text-primary)"},children:"Support Chat"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"fas fa-search absolute left-3 top-3",style:{color:"var(--color-text-light)"}}),e.jsx("input",{type:"text",placeholder:"Search conversations...",value:p,onChange:e=>u(e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:outline-none",style:{borderColor:"var(--color-border-light)",color:"var(--color-text-primary)"},onFocus:e=>e.target.style.boxShadow="0 0 0 2px var(--color-accent-primary)33"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:0===M.length?e.jsx("div",{className:"p-4 text-center",style:{color:"var(--color-text-light)"},children:p?"No conversations found":"No conversations yet"}):M.map(t=>e.jsxs("div",{onClick:()=>{return c(e=t),b(t=>{const r={...t};return delete r[e._id],r}),void A(e);var e},className:"p-4 border-b cursor-pointer transition relative "+(l?._id===t._id?"bg-blue-50 border-l-4":"hover:bg-gray-50"),style:{borderColor:l?._id===t._id?"var(--color-accent-primary)":"var(--color-border-light)",backgroundColor:(f[t._id]||0)>0?"rgba(255, 193, 7, 0.05)":l?._id===t._id?"rgba(var(--color-accent-primary-rgb), 0.05)":"transparent",overflow:"visible"},children:[(f[t._id]||0)>0&&e.jsx("div",{className:"absolute top-2 right-2 flex items-center gap-2",children:e.jsx("div",{className:"flex items-center justify-center text-white font-bold rounded-full animate-pulse",style:{backgroundColor:"#dc2626",width:"32px",height:"32px",minWidth:"32px",fontSize:"14px",boxShadow:"0 4px 12px rgba(220, 38, 38, 0.6)",border:"2px solid white",zIndex:10},children:f[t._id]>9?"9+":f[t._id]})}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1 "+("admin"===t.lastMessageSender?"text-green-500":(f[t._id]||0)>0?"text-red-500":"text-blue-500"),children:e.jsx("i",{className:"fas fa-circle",style:{fontSize:"12px"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"font-semibold truncate "+((f[t._id]||0)>0?"text-red-600":""),style:{color:(f[t._id]||0)>0?"#dc2626":"var(--color-text-primary)"},children:t.userName||t.userEmail||"Unknown"}),(f[t._id]||0)>0&&e.jsx("span",{className:"text-xs font-bold px-2 py-1 rounded-full",style:{backgroundColor:"#fee2e2",color:"#dc2626"},children:"NEW"})]}),e.jsx("p",{className:"text-sm truncate",style:{color:"var(--color-text-light)"},children:t.userEmail||""}),e.jsx("p",{className:"text-xs mt-1 font-semibold",style:{color:(f[t._id]||0)>0?"#dc2626":"var(--color-text-light)"},children:(f[t._id]||0)>0?`${f[t._id]} unread message${f[t._id]>1?"s":""}`:`${t.messageCount} messages`})]}),e.jsx("span",{className:"flex-shrink-0 text-xs",style:{color:"var(--color-text-light)"},children:B(t.lastMessageAt)})]})]},t._id))})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-6 border-b flex-shrink-0",style:{borderColor:"var(--color-border-light)",backgroundColor:"var(--color-bg-section)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)"},children:l.userName||l.userEmail}),e.jsx("p",{style:{color:"var(--color-text-light)"},children:l.userEmail}),l.userPhone&&e.jsx("p",{style:{color:"var(--color-text-light)"},children:l.userPhone})]}),e.jsx("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),c(null)},className:"p-2 rounded-lg transition hover:bg-red-100",style:{color:"#dc2626"},title:"Close chat",children:e.jsx("i",{className:"fas fa-times",style:{fontSize:"24px"}})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 min-h-0",style:{backgroundColor:"var(--color-bg-primary)"},children:[l.messages&&l.messages.length>0?l.messages.map((t,r)=>e.jsx("div",{className:"flex "+("admin"===t.sender?"justify-start":"justify-end"),children:e.jsxs("div",{className:("admin"===t.sender?"bg-green-100 text-gray-900":"text-white")+" p-4 rounded-lg max-w-xs shadow-md",style:"admin"!==t.sender?{backgroundColor:"var(--color-accent-primary)"}:{},children:[e.jsx("p",{className:"text-sm font-semibold mb-1 "+("admin"===t.sender?"text-gray-700":"text-green-100"),children:t.senderName}),e.jsx("p",{className:"whitespace-pre-wrap text-sm",children:t.message}),e.jsx("p",{className:"text-xs mt-2 opacity-75",children:new Date(t.createdAt).toLocaleString()})]})},t._id||r)):e.jsx("div",{className:"flex justify-center items-center h-full",style:{color:"var(--color-text-light)"},children:"No messages yet"}),e.jsx("div",{ref:k})]}),e.jsx("div",{className:"border-t p-4 flex-shrink-0",style:{borderColor:"var(--color-border-light)",backgroundColor:"var(--color-bg-primary)"},children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),i.trim())if(l){h(!0);try{const e=localStorage.getItem("token");if(!(await fetch(`${E}/api/forms/contact/admin/send`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({userEmail:l.userEmail,message:i.trim(),senderName:z})})).ok)throw new Error("Failed to send message");r.success("Message sent"),n(""),A(l.conversationId)}catch(t){r.error(t.message||"Failed to send message")}finally{h(!1)}}else r.error("Please select a conversation");else r.error("Please enter a message")},className:"space-y-3",children:[e.jsx("textarea",{value:i,onChange:e=>n(e.target.value),placeholder:"Type your message...",className:"w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 resize-none text-sm",style:{borderColor:"var(--color-border-light)",color:"var(--color-text-primary)",backgroundColor:"var(--color-bg-section)"},rows:"2",disabled:x,onFocus:e=>e.target.style.boxShadow="0 0 0 2px var(--color-accent-primary)33"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"submit",disabled:x||!i.trim(),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 text-white font-semibold rounded-lg transition text-sm disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:"var(--color-accent-primary)"},onMouseEnter:e=>!e.target.disabled&&(e.target.style.filter="brightness(1.1)"),onMouseLeave:e=>!e.target.disabled&&(e.target.style.filter="brightness(1)"),children:[e.jsx("i",{className:"fas fa-paper-plane",style:{fontSize:"14px"}}),x?"Sending...":"Send Message"]}),e.jsx("button",{type:"button",onClick:()=>n(""),className:"px-4 py-2 rounded-lg font-semibold transition text-sm",style:{backgroundColor:"var(--color-bg-section)",color:"var(--color-text-primary)"},onMouseEnter:e=>e.target.style.backgroundColor="var(--color-border-light)",onMouseLeave:e=>e.target.style.backgroundColor="var(--color-bg-section)",children:"Clear"})]})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center",style:{backgroundColor:"var(--color-bg-primary)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"fas fa-comments mx-auto mb-6",style:{fontSize:"64px",color:"var(--color-accent-primary)",opacity:.3}}),e.jsx("p",{className:"text-2xl font-bold mb-2",style:{color:"var(--color-text-primary)"},children:"No Conversation Selected"}),e.jsx("p",{style:{color:"var(--color-text-light)",maxWidth:"400px"},children:"Select a conversation from the list on the left to start chatting with customers"})]})})})]}),"contact"===y&&e.jsx("div",{className:"w-full flex flex-col overflow-hidden",style:{backgroundColor:"var(--color-bg-primary)"},children:0===N.length?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",style:{color:"var(--color-text-light)"},children:[e.jsx("i",{className:"fas fa-envelope mx-auto mb-4",style:{fontSize:"64px",color:"var(--color-accent-primary)"}}),e.jsx("p",{className:"text-xl font-semibold",children:"No Contact Submissions"}),e.jsx("p",{className:"text-sm mt-2",children:"Contact form submissions will appear here"})]})}):e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"space-y-4 p-6",children:N.map(t=>e.jsxs("div",{className:"border rounded-lg p-4",style:{borderColor:t.movedToChat?"var(--color-success)":"var(--color-border-light)",backgroundColor:"var(--color-bg-section)"},children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-lg",style:{color:"var(--color-text-primary)"},children:t.userName||"Unknown"}),t.movedToChat&&e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded text-white",style:{backgroundColor:"var(--color-success)"},children:"Moved"})]}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-light)"},children:t.userEmail}),t.userPhone&&e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-light)"},children:t.userPhone})]}),e.jsxs("div",{className:" flex gap-2 flex-col items-end ",children:[e.jsx("div",{className:"text-xs text-right",style:{color:"var(--color-text-light)"},children:new Date(t.createdAt||t.lastMessageAt).toLocaleDateString()}),!t.movedToChat&&e.jsx("button",{onClick:()=>(async e=>{try{const t=localStorage.getItem("token"),s=await fetch(`${E}/api/forms/contact/${e._id}/moveToChat`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!s.ok)throw new Error("Failed to move contact to chat");const o=await s.json();c(o.data),j("chat"),A(o.data),F(),r.success("Contact moved to chat successfully")}catch(t){r.error("Failed to move contact to chat")}})(t),className:"flex-1 px-4 py-2 text-white font-semibold rounded-lg transition text-sm",style:{backgroundColor:"var(--color-accent-primary)"},onMouseEnter:e=>e.target.style.filter="brightness(1.1)",onMouseLeave:e=>e.target.style.filter="brightness(1)",children:"Move to Chat"})]})]}),e.jsxs("div",{className:"mb-3 p-3 rounded",style:{backgroundColor:"var(--color-bg-primary)"},children:[e.jsx("p",{className:"text-sm mb-2 font-semibold",style:{color:"var(--color-text-primary)"},children:t.messages?.[0]?.subject||t.messages?.[0]?.message?.substring(0,50)||"Message"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-light)"},children:t.messages?.[0]?.message||"No content"})]})]},t._id))})})}),"newsletter"===y&&e.jsx("div",{className:"w-full flex flex-col overflow-hidden",style:{backgroundColor:"var(--color-bg-primary)"},children:0===C.length?e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",style:{color:"var(--color-text-light)"},children:[e.jsx("i",{className:"fas fa-bullhorn mx-auto mb-4",style:{fontSize:"64px",color:"var(--color-accent-primary)"}}),e.jsx("p",{className:"text-xl font-semibold",children:"No Newsletter Subscribers"}),e.jsx("p",{className:"text-sm mt-2",children:"Newsletter subscriptions will appear here"})]})}):e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)"},children:["Newsletter Subscribers (",C.length,")"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderColor:"var(--color-border-light)",borderBottomWidth:"2px"},children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold",style:{color:"var(--color-text-primary)"},children:"Email"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold",style:{color:"var(--color-text-primary)"},children:"Subscribed"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold",style:{color:"var(--color-text-primary)"},children:"Status"})]})}),e.jsx("tbody",{children:C.map(t=>e.jsxs("tr",{style:{borderColor:"var(--color-border-light)",borderBottomWidth:"1px"},children:[e.jsx("td",{className:"py-3 px-4",style:{color:"var(--color-text-primary)"},children:t.email}),e.jsx("td",{className:"py-3 px-4 text-sm",style:{color:"var(--color-text-light)"},children:new Date(t.createdAt||t.subscribedAt).toLocaleDateString()}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold",style:{backgroundColor:t.isSubscribed?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",color:t.isSubscribed?"#22c55e":"#ef4444"},children:t.isSubscribed?"Active":"Unsubscribed"})})]},t._id))})]})})]})})})]})]})})};export{o as default};
