import{E as e,u as t,i as s,a,j as r,b as i}from"./editor-BiSlXHWs.js";import{R as n,u as l,a as o,g as c}from"./vendor-0z5P9xg-.js";import{d}from"./redux-DhaBhdiE.js";import{t as m,z as u}from"./index-BiO51Ilc.js";import{S as g}from"./SEOMetaForm-qWumqhTN.js";var x=e.create({name:"textAlign",addOptions:()=>({types:[],alignments:["left","center","right","justify"],defaultAlignment:null}),addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:e=>{const t=e.style.textAlign;return this.options.alignments.includes(t)?t:this.options.defaultAlignment},renderHTML:e=>e.textAlign?{style:`text-align: ${e.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:e=>({commands:t})=>!!this.options.alignments.includes(e)&&this.options.types.map(s=>t.updateAttributes(s,{textAlign:e})).some(e=>e),unsetTextAlign:()=>({commands:e})=>this.options.types.map(t=>e.resetAttributes(t,"textAlign")).some(e=>e),toggleTextAlign:e=>({editor:t,commands:s})=>!!this.options.alignments.includes(e)&&(t.isActive({textAlign:e})?s.unsetTextAlign():s.setTextAlign(e))}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}});const p=({value:e="",onChange:l=()=>{}})=>{const[o,c]=n.useState(""),[d,m]=n.useState(!1),[u,g]=n.useState(!1),p=t({extensions:[s,x.configure({types:["heading","paragraph"]}),a.configure({openOnClick:!1,HTMLAttributes:{class:"text-gray-700 hover:text-gray-800 underline cursor-pointer","data-new-tab":!1}})],content:e,onUpdate:({editor:e})=>{l(e.getHTML())}});if(n.useEffect(()=>{p&&e&&p.getHTML()!==e&&p.commands.setContent(e)},[e,p]),!p)return r.jsx("div",{className:"text-gray-900",children:"Loading editor..."});const h=e=>"flex items-center justify-center p-2 rounded transition "+(e?"bg-gray-800 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200");return r.jsxs("div",{className:"border border-gray-300 rounded-lg overflow-hidden",children:[r.jsxs("div",{className:"flex flex-wrap gap-1 bg-gray-50 p-3 border-b border-gray-300",children:[r.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleBold().run(),disabled:!p.can().chain().focus().toggleBold().run(),className:h(p.isActive("bold")),title:"Bold (Ctrl+B)",children:r.jsx("i",{className:"fas fa-bold text-sm"})}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleItalic().run(),disabled:!p.can().chain().focus().toggleItalic().run(),className:h(p.isActive("italic")),title:"Italic (Ctrl+I)",children:r.jsx("i",{className:"fas fa-italic text-sm"})}),r.jsx("div",{className:"w-px bg-gray-300 mx-1"}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().setParagraph().run(),className:h(p.isActive("paragraph")),title:"Paragraph",children:r.jsx("span",{className:"text-xs font-bold",children:"Â¶"})}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleHeading({level:1}).run(),className:h(p.isActive("heading",{level:1})),title:"Heading 1",children:r.jsx("span",{className:"text-xs font-bold",children:"H1"})}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleHeading({level:2}).run(),className:h(p.isActive("heading",{level:2})),title:"Heading 2",children:r.jsx("span",{className:"text-xs font-bold",children:"H2"})}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleHeading({level:3}).run(),className:h(p.isActive("heading",{level:3})),title:"Heading 3",children:r.jsx("span",{className:"text-xs font-bold",children:"H3"})}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleHeading({level:4}).run(),className:h(p.isActive("heading",{level:4})),title:"Heading 4",children:r.jsx("span",{className:"text-xs font-bold",children:"H4"})}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleHeading({level:5}).run(),className:h(p.isActive("heading",{level:5})),title:"Heading 5",children:r.jsx("span",{className:"text-xs font-bold",children:"H5"})}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleHeading({level:6}).run(),className:h(p.isActive("heading",{level:6})),title:"Heading 6",children:r.jsx("span",{className:"text-xs font-bold",children:"H6"})}),r.jsx("div",{className:"w-px bg-gray-300 mx-1"}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleBulletList().run(),className:h(p.isActive("bulletList")),title:"Bullet List",children:r.jsx("i",{className:"fas fa-list text-sm"})}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleOrderedList().run(),className:h(p.isActive("orderedList")),title:"Ordered List",children:r.jsx("i",{className:"fas fa-list-ol text-sm"})}),r.jsx("div",{className:"w-px bg-gray-300 mx-1"}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().toggleCodeBlock().run(),className:h(p.isActive("codeBlock")),title:"Code Block",children:r.jsx("i",{className:"fas fa-code text-sm"})}),r.jsx("div",{className:"w-px bg-gray-300 mx-1"}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().setTextAlign("left").run(),className:h(p.isActive({textAlign:"left"})),title:"Align Left",children:r.jsx("i",{className:"fas fa-align-left text-sm"})}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().setTextAlign("center").run(),className:h(p.isActive({textAlign:"center"})),title:"Align Center",children:r.jsx("i",{className:"fas fa-align-center text-sm"})}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().setTextAlign("right").run(),className:h(p.isActive({textAlign:"right"})),title:"Align Right",children:r.jsx("i",{className:"fas fa-align-right text-sm"})}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().setTextAlign("justify").run(),className:h(p.isActive({textAlign:"justify"})),title:"Justify",children:r.jsx("i",{className:"fas fa-align-justify text-sm"})}),r.jsx("div",{className:"w-px bg-gray-300 mx-1"}),u?r.jsxs("div",{className:"flex gap-1 items-center flex-wrap",children:[r.jsx("input",{type:"text",placeholder:"Enter URL",value:o,onChange:e=>c(e.target.value),className:"px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:border-gray-800",onKeyDown:e=>{"Enter"===e.key?(p.chain().focus().setLink({href:o,target:d?"_blank":null}).run(),c(""),m(!1),g(!1)):"Escape"===e.key&&g(!1)},autoFocus:!0}),r.jsxs("label",{className:"flex items-center gap-1 text-xs whitespace-nowrap",children:[r.jsx("input",{type:"checkbox",checked:d,onChange:e=>m(e.target.checked),className:"w-4 h-4"}),r.jsx("span",{children:"New Tab"})]}),r.jsx("button",{type:"button",onClick:()=>{o&&(p.chain().focus().setLink({href:o,target:d?"_blank":null}).run(),c(""),m(!1),g(!1))},className:"px-2 py-1 bg-gray-800 text-white rounded text-xs font-semibold hover:bg-black",children:"Add"}),r.jsx("button",{type:"button",onClick:()=>{g(!1),c(""),m(!1)},className:"px-2 py-1 bg-gray-300 text-gray-700 rounded text-xs hover:bg-black",children:"Cancel"})]}):r.jsxs(r.Fragment,{children:[r.jsx("button",{type:"button",onClick:()=>{g(!0),c(""),m(!1)},className:h(p.isActive("link")),title:"Add Link",children:r.jsx("i",{className:"fas fa-link text-sm"})}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().unsetLink().run(),disabled:!p.isActive("link"),className:h(!1),title:"Remove Link",children:r.jsx("i",{className:"fas fa-link-slash text-sm"})})]}),r.jsx("div",{className:"w-px bg-gray-300 mx-1"}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().undo().run(),disabled:!p.can().chain().focus().undo().run(),className:h(!1),title:"Undo (Ctrl+Z)",children:r.jsx("i",{className:"fas fa-arrow-rotate-left text-sm"})}),r.jsx("button",{type:"button",onClick:()=>p.chain().focus().redo().run(),disabled:!p.can().chain().focus().redo().run(),className:h(!1),title:"Redo (Ctrl+Y)",children:r.jsx("i",{className:"fas fa-arrow-rotate-right text-sm"})})]}),r.jsx(i,{editor:p,className:"prose prose-sm max-w-none focus:outline-none px-4 py-3 min-h-40 bg-white"})]})},h="https://api.wolfsupplies.co.uk",b=()=>{const e=l(),t=d(e=>e.auth||{}).token||localStorage.getItem("token"),[s,a]=o.useState(!1),[i,x]=o.useState(""),[b,f]=o.useState(null),[y,v]=o.useState({name:"",price:"",comparePrice:"",slug:"",stock:"",categories:[],description:"",benefitsHeading:"",benefitsText:"",images:[],options:[],variants:[],isDraft:!1,metaTitle:"",metaDescription:"",metaKeywords:""}),[j,N]=o.useState(!1),[w,k]=o.useState(!1),[C,A]=o.useState(""),[S,D]=o.useState(""),[T,$]=o.useState({}),[P,V]=o.useState({}),[L,E]=o.useState({}),[H,O]=o.useState([]),[_,z]=o.useState(!1),[B,M]=o.useState(!1),[F,R]=o.useState(!1),[I,K]=o.useState(null),[G,q]=o.useState(!1),[J,U]=o.useState(null),[W,Z]=o.useState(null),[X,Y]=o.useState(!1),[Q,ee]=o.useState({}),{id:te}=c(),se=Boolean(te),[ae,re]=o.useState(null);n.useRef(!0);const[ie,ne]=o.useState([]),[le,oe]=o.useState([]),ce=n.useRef({});n.useEffect(()=>{if(!te)return;(async()=>{try{const e=(await m.get(`${h}/api/products/${te}`)).data;let t="";"string"==typeof e.benefits?t=e.benefits:Array.isArray(e.benefits)&&e.benefits.length>0&&(t=`<ul>${e.benefits.map(e=>`<li>${e}</li>`).join("")}</ul>`),v(s=>({...s,name:e.name||"",price:e.price||"",comparePrice:e.originalPrice||"",slug:e.slug||"",stock:e.stock||"",categories:e.categories?e.categories.map(e=>e._id?e._id:e):[],description:e.description||"",whyBuyText:e.whyBuyText||"",benefitsHeading:e.benefitsHeading||" ",benefitsText:t,images:Array.isArray(e.images)?e.images:e.images?[e.images]:[],options:e.variants||[],variants:(e.variantCombinations||[]).map((e,t)=>({id:e._id||`variant-${t}`,optionValues:e.variantValues||{},sku:e.sku||"",price:e.price||"",stock:e.stock||0,image:e.image||""})),metaTitle:e.metaTitle||"",metaDescription:e.metaDescription||"",metaKeywords:e.metaKeywords||""}))}catch(e){}})()},[te]),n.useEffect(()=>{de()},[]),n.useEffect(()=>{if(y.options&&y.options.length>0){const e=y.options.find(e=>e.name);e&&e.name&&A(e.name)}},[y.options]);const de=async()=>{try{const e=await m.get(`${h}/api/categories`);O(e.data)}catch(e){}};n.useEffect(()=>{te&&y.name&&re(JSON.parse(JSON.stringify(y)))},[te]);const me=()=>!(!ae&&!y.name)&&(!(ae||!y.name)||!(!ae||JSON.stringify(ae)===JSON.stringify(y))),ue=(()=>{try{const e=""===y.price||null===y.price?NaN:parseFloat(y.price),t=""===y.comparePrice||null===y.comparePrice?NaN:parseFloat(y.comparePrice);return!isNaN(t)&&!isNaN(e)&&t<=e?"Compare price must be greater than Price":""}catch(e){return""}})();n.useEffect(()=>{const e=e=>{if(me())return e.preventDefault(),e.returnValue="",""};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[y,ae]),n.useEffect(()=>{"saved"===b&&me()&&f(null)},[y]);const ge=e=>{if(me()){window.confirm("You have unsaved changes. Are you sure you want to leave without saving or discarding?")&&e()}else e()},xe=e=>String(e??"â€”").trim(),pe=(e={})=>{try{const t=Object.entries(e||{});if(C&&Object.prototype.hasOwnProperty.call(e||{},C)){const s=[[C,e[C]]],a=t.filter(([e])=>e!==C);return[...s,...a].map(([e,t])=>`${e}: ${t}`).join(" / ")}if(y.options&&y.options.length>0){const e=y.options.map(e=>e.name).filter(Boolean);return t.slice().sort((t,s)=>{const a=e.indexOf(t[0]),r=e.indexOf(s[0]),i=-1===a?Number.MAX_SAFE_INTEGER:a,n=-1===r?Number.MAX_SAFE_INTEGER:r;return i===n?String(t[0]).localeCompare(String(s[0])):i-n}).map(([e,t])=>`${e}: ${t}`).join(" / ")}return t.map(([e,t])=>`${e}: ${t}`).join(" / ")}catch(t){return""}},he=(e,t,s)=>{const a=xe(e);E(e=>({...e,[a]:{...e[a]||{},[t]:s}}))},be=(e,t,s)=>{const a=xe(e),r=void 0!==s?s:L?.[a]?.[t];if(null==r||""===r)return;let i=r;if("price"===t){const e=parseFloat(r);if(isNaN(e))return;i=e}else if("stock"===t){const e=parseInt(r);if(isNaN(e))return;i=e}const n=y.variants.map(e=>xe(e.optionValues&&e.optionValues[C])!==a?e:{...e,[t]:i});v({...y,variants:n})},fe=(e,t)=>{const s=String(t||"").trim();s&&v(t=>{const a=(t.options||[]).map((t,a)=>{if(a!==e)return t;const r=Array.isArray(t.values)?[...t.values]:[];return r.includes(s)?{...t,values:r}:{...t,values:[...r,s]}});return{...t,options:a}})},ye=async(s,r=!0)=>{if(s&&s.preventDefault&&s.preventDefault(),x(""),y.name.trim()){if(ue)return x(ue),void("function"==typeof u&&u.error(ue));a(!0),f("saving");try{const s=Array.isArray(y.images)?y.images:[],a=(y.options||[]).map(e=>({name:e.name,values:e.values})),i=(y.variants||[]).map(e=>({variantValues:e.optionValues||{},sku:e.sku||"",price:e.price?parseFloat(e.price):y.price?parseFloat(y.price):0,stock:e.stock?parseInt(e.stock):0,image:e.image||""})),n=e=>String(e||"").toLowerCase().trim().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"").replace(/-+/g,"-"),l={name:y.name,slug:y.slug||n(y.name),description:y.description||"",price:y.price?parseFloat(y.price):0,originalPrice:y.comparePrice&&""!==y.comparePrice.trim()?parseFloat(y.comparePrice):null,stock:y.stock?parseInt(y.stock):0,images:s,variants:a,variantCombinations:i,categories:y.categories||[],benefits:y.benefitsText||"",benefitsHeading:y.benefitsHeading||" ",metaTitle:y.metaTitle||"",metaDescription:y.metaDescription||"",metaKeywords:y.metaKeywords||"",isDraft:!r},o=t?{Authorization:`Bearer ${t}`}:{};if(se){await m.put(`${h}/api/products/${te}`,l,{headers:o});u.success(r?"Product saved successfully!":"Product saved as draft");const e=(await m.get(`${h}/api/products/${te}`)).data;let t="";"string"==typeof e.benefits?t=e.benefits:Array.isArray(e.benefits)&&e.benefits.length>0&&(t=`<ul>${e.benefits.map(e=>`<li>${e}</li>`).join("")}</ul>`);const s={name:e.name||"",price:e.price||"",comparePrice:e.originalPrice||"",slug:e.slug||"",stock:e.stock||"",categories:e.categories?e.categories.map(e=>e._id?e._id:e):[],description:e.description||"",benefitsText:t,benefitsHeading:e.benefitsHeading||" ",images:Array.isArray(e.images)?e.images:e.images?[e.images]:[],options:e.variants||[],variants:(e.variantCombinations||[]).map((e,t)=>({id:e._id||`variant-${t}`,optionValues:e.variantValues||{},sku:e.sku||"",price:e.price||"",stock:e.stock||0,image:e.image||""})),isDraft:e.isDraft||!1};v(s),re(JSON.parse(JSON.stringify(s))),f("saved"),setTimeout(()=>f(null),2e3)}else{const t=(await m.post(`${h}/api/products`,l,{headers:o})).data;r?(u.success("Product published successfully!"),v({name:"",price:"",comparePrice:"",slug:"",stock:"",categories:[],description:"",benefitsText:"",images:[],options:[],variants:[],isDraft:!1}),re(null),f("saved"),setTimeout(()=>f(null),2e3),setTimeout(()=>e("/admin/products"),1200)):(u.success("Draft created. Redirecting to editor..."),f("saved"),setTimeout(()=>f(null),2e3),setTimeout(()=>e(`/admin/products/edit/${t._id}`),800))}}catch(i){const e=i.response?.data?.message||i.message||"Error creating/updating product";u.error(e),x(e),f(null)}finally{a(!1)}}else x("Product name is required")},ve=()=>{const e={};y.options.forEach(t=>{e[t.name]=""}),ee(e),Y(!0)},je=()=>{v({...y,variants:[...y.variants,{id:`variant-${Date.now()}`,name:`Variant ${y.variants.length+1}`,optionValues:Q,sku:"",price:y.price||"",stock:0,image:""}]}),Y(!1),u.success("Variant added")},Ne=(e,t)=>{const s=y.variants.map(s=>s.id===e?{...s,...t}:s);v({...y,variants:s})},we=async e=>{try{const s=new FormData;s.append("image",e);const a=t?{Authorization:`Bearer ${t}`}:{};return(await m.post(`${h}/api/upload`,s,{headers:{...a,"Content-Type":"multipart/form-data"}})).data.url}catch(s){return x("Failed to upload image. Please try again."),null}},ke=e=>{v(t=>({...t,images:[...t.images||[],e]}))},Ce=e=>{v({...y,images:y.images.filter((t,s)=>s!==e)})},Ae=(e,t)=>{if(e===t)return;const s=Array.isArray(y.images)?[...y.images]:[];if(e<0||e>=s.length)return;const[a]=s.splice(e,1);s.splice(Math.max(0,Math.min(t,s.length)),0,a),v({...y,images:s})},Se=e=>{if(!e)return"";try{return"string"!=typeof e?"":e.startsWith("http")?e:`${h}${e}`}catch(t){return""}},De=({show:e,onClose:t})=>{const[s,a]=n.useState(y.categories||[]);n.useEffect(()=>a(y.categories||[]),[y.categories,e]);const i=(e,t=0)=>{if(!e)return[];let s=[];if(Array.isArray(e))s=e;else{if("object"!=typeof e)return[];s=Object.values(e)}const a=[];for(const r of s)r&&r._id&&(a.push({_id:r._id,name:r.name,parent:r.parent,_depth:t}),r.subcategories&&(Array.isArray(r.subcategories)||"object"==typeof r.subcategories)&&a.push(...i(r.subcategories,t+1)));return a};if(!e)return null;const l=i(H||[]);return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-[min(900px,95%)] max-h-[95vh] overflow-y-auto p-6",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4 sticky top-0 bg-white py-3",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("i",{className:"fas fa-tags text-xl text-gray-700"}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Select Categories"}),r.jsx("p",{className:"text-xs text-gray-900",children:"Choose which categories this product should belong to"})]})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("button",{onClick:t,className:"text-gray-600 hover:text-gray-900 p-2 rounded-full hover:bg-gray-100","aria-label":"Close categories modal",children:r.jsx("i",{className:"fas fa-times text-lg"})})})]}),r.jsx("div",{className:"mb-4",children:r.jsx("input",{type:"search",placeholder:"Search categories...",className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-200 outline-none",onChange:e=>{const t=e.target.value.trim().toLowerCase();document.querySelectorAll("[data-cat-name]").forEach(e=>{const s=e.getAttribute("data-cat-name")||"";e.style.display=s.toLowerCase().includes(t)?"":"none"})}})}),r.jsx("div",{className:"grid gap-2",children:l&&l.length>0?l.map(e=>r.jsxs("label",{"data-cat-name":e.name,className:"flex items-center gap-3 p-3 bg-gray-50 hover:bg-white border border-gray-100 rounded-lg cursor-pointer transition",children:[r.jsx("input",{type:"checkbox",checked:s.includes(e._id),onChange:()=>{return t=e._id,void a(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"w-4 h-4 cursor-pointer text-gray-700"}),r.jsxs("div",{className:"flex-1",children:[r.jsx("div",{className:"text-sm text-gray-800 font-medium",children:e.name}),e._depth?r.jsx("div",{className:"text-xs text-gray-400",children:Array(e._depth).fill("Â· ").join("")}):null]})]},`cat-${e._id}`)):r.jsx("p",{className:"text-gray-900 text-sm py-4",children:"No categories available"})}),r.jsxs("div",{className:"mt-4 flex justify-end gap-3",children:[r.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 rounded border border-gray-300 hover:bg-gray-50",children:"Cancel"}),r.jsx("button",{type:"button",onClick:()=>{v({...y,categories:s}),t()},className:"px-4 py-2 rounded bg-[var(--color-accent-primary)] text-white hover:bg-black",children:"Save"})]})]})})},Te=({show:e,onClose:t})=>{if(!e)return null;const s=(y.images||[]).slice(1);return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-[min(900px,95%)] max-h-[85vh] overflow-y-auto p-6",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4 sticky top-0 bg-white",children:[r.jsxs("h3",{className:"text-lg font-semibold",children:["All Gallery Images (",s.length,")"]}),r.jsx("button",{onClick:t,className:"text-gray-600 hover:text-gray-900",children:r.jsx("i",{className:"fas fa-times",style:{fontSize:"20px"}})})]}),r.jsx("div",{className:"grid grid-cols-4 gap-4",children:s.map((e,s)=>{const a=s+1;return r.jsxs("div",{className:"relative group rounded-lg overflow-hidden bg-gray-100 cursor-grab border border-gray-200 h-40",draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain",String(a))},onDoubleClick:()=>{Ae(a,0),t()},children:[r.jsx("img",{src:Se(e),alt:`Gallery ${a}`,className:"w-full h-full object-cover"}),r.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition flex items-center justify-center opacity-0 group-hover:opacity-100",children:r.jsx("div",{className:"text-center text-white",children:r.jsx("p",{className:"text-xs font-semibold",children:"Double-click to set as main"})})}),r.jsx("button",{type:"button",onClick:()=>Ce(a),className:"absolute top-2 right-2 bg-gray-700 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition","aria-label":"Remove image",children:r.jsx("i",{className:"fas fa-times",style:{fontSize:"12px"}})})]},a)})}),r.jsx("div",{className:"mt-6 flex justify-end",children:r.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 rounded bg-gray-300 text-gray-900 hover:bg-black",children:"Close"})})]})})},$e=({show:e,onClose:t})=>{if(!e||!I)return null;const s=y.images||[];return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-[min(900px,95%)] max-h-[85vh] overflow-y-auto p-6",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4 sticky top-0 bg-white",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Select Image for Variant"}),r.jsx("button",{onClick:t,className:"text-gray-600 hover:text-gray-900",children:r.jsx("i",{className:"fas fa-times",style:{fontSize:"20px"}})})]}),r.jsx("div",{className:"grid grid-cols-4 gap-4",children:s.map((e,s)=>r.jsxs("div",{onClick:()=>{Ne(I.id,{image:e}),t(),K(null)},draggable:!0,onDragStart:t=>{t.dataTransfer.effectAllowed="copy",t.dataTransfer.setData("text/plain",e)},className:"relative group rounded-lg overflow-hidden bg-gray-100 cursor-pointer border-2 border-gray-200 h-40 hover:border-gray-800 transition",children:[r.jsx("img",{src:Se(e),alt:`Product ${s}`,className:"w-full h-full object-cover group-hover:scale-105 transition"}),r.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition flex items-center justify-center opacity-0 group-hover:opacity-100",children:r.jsx("div",{className:"text-center text-white",children:r.jsxs("p",{className:"text-sm font-semibold",children:["Click to select",r.jsx("br",{}),"or drag"]})})}),I?.image===e&&r.jsx("div",{className:"absolute top-2 right-2 bg-[var(--color-accent-primary)] text-white px-2 py-1 rounded text-xs font-semibold",children:"Selected"})]},s))}),r.jsx("div",{className:"mt-6 flex justify-end gap-3",children:r.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 rounded bg-gray-300 text-gray-900 hover:bg-black",children:"Close"})})]})})},Pe=({show:e,onClose:t})=>{if(!e||!J)return null;const s=y.images||[];return r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-[min(900px,95%)] max-h-[85vh] overflow-y-auto p-6",children:[r.jsxs("div",{className:"flex justify-between items-center mb-4 sticky top-0 bg-white",children:[r.jsxs("h3",{className:"text-lg font-semibold",children:["Select Image for Group: ",J]}),r.jsx("button",{onClick:t,className:"text-gray-600 hover:text-gray-900",children:r.jsx("i",{className:"fas fa-times",style:{fontSize:"20px"}})})]}),r.jsx("div",{className:"grid grid-cols-4 gap-4",children:s.map((e,s)=>r.jsxs("div",{onClick:()=>{he(J,"image",e),be(J,"image",e),t(),U(null)},draggable:!0,onDragStart:t=>{t.dataTransfer.effectAllowed="copy",t.dataTransfer.setData("text/plain",e)},onDragEnd:e=>{e.preventDefault()},className:"relative group rounded-lg overflow-hidden bg-gray-100 cursor-grab active:cursor-grabbing border-2 border-gray-200 h-40 hover:border-gray-800 transition",children:[r.jsx("img",{src:Se(e),alt:`Product ${s}`,className:"w-full h-full object-cover group-hover:scale-105 transition"}),r.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition flex items-center justify-center opacity-0 group-hover:opacity-100",children:r.jsx("div",{className:"text-center text-white",children:r.jsxs("p",{className:"text-sm font-semibold",children:["Click to select",r.jsx("br",{}),"or drag to variant"]})})})]},s))}),r.jsx("div",{className:"mt-6 flex justify-end gap-3",children:r.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 rounded bg-gray-300 text-gray-900 hover:bg-black",children:"Close"})})]})})},Ve=({show:e,onClose:t})=>e?r.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:r.jsxs("div",{className:"bg-white rounded-lg shadow-2xl w-[min(500px,95%)] p-6",children:[r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsx("h3",{className:"text-lg font-semibold",children:"Add New Variant"}),r.jsx("button",{onClick:t,className:"text-gray-600 hover:text-gray-900",children:r.jsx("i",{className:"fas fa-times",style:{fontSize:"20px"}})})]}),0===y.options.length?r.jsxs("div",{className:"text-center py-8",children:[r.jsx("p",{className:"text-gray-600 mb-4",children:"No options added yet."}),r.jsx("p",{className:"text-sm text-gray-500",children:"Add options (like Size, Color) first to create variants."})]}):r.jsx("div",{className:"space-y-4 mb-6",children:y.options.map(e=>r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:e.name}),r.jsxs("select",{value:Q[e.name]||"",onChange:t=>ee(s=>({...s,[e.name]:t.target.value})),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-gray-800 outline-none",children:[r.jsxs("option",{value:"",children:["Select ",e.name]}),e.values.map(e=>r.jsx("option",{value:e,children:e},e))]})]},e.name))}),r.jsxs("div",{className:"flex justify-end gap-3",children:[r.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 rounded border border-gray-300 hover:bg-gray-50",children:"Cancel"}),r.jsx("button",{type:"button",onClick:je,disabled:0===y.options.length||y.options.some(e=>!Q[e.name]),className:"px-4 py-2 rounded bg-[var(--color-accent-primary)] text-white hover:bg-black disabled:opacity-50 disabled:cursor-not-allowed",children:"Add Variant"})]})]})}):null;return r.jsxs("div",{className:"min-h-screen bg-gray-100 p-4",children:[r.jsxs("div",{className:"max-w-7xl mx-auto",children:[r.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[r.jsxs("button",{onClick:()=>ge(()=>e("/admin/products")),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900",children:[r.jsx("i",{className:"fas fa-arrow-left"})," Back"]}),r.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:gap-4 w-full",children:[r.jsx("h1",{className:"text-xl font-bold text-gray-900",children:se?"Edit Product":"Add New Product"}),r.jsxs("div",{className:"ml-auto flex items-center gap-3",children:["saving"===b&&r.jsx("span",{className:"text-sm text-gray-600",children:"Saving..."}),"saved"===b&&r.jsx("span",{className:"text-sm text-green-600 font-semibold",children:"Saved"}),r.jsxs("select",{value:y.isDraft?"draft":"published",onChange:e=>v({...y,isDraft:"draft"===e.target.value}),className:"px-3 py-1 rounded-lg text-sm font-semibold border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-800",children:[r.jsx("option",{value:"published",children:"Published"}),r.jsx("option",{value:"draft",children:"Draft"})]}),r.jsx("button",{onClick:()=>ye(null,!y.isDraft),disabled:s||Boolean(ue),className:"px-4 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-semibold transition disabled:opacity-50",children:s?"Saving...":"Save"}),r.jsx("button",{onClick:()=>ge(()=>e("/admin/products")),className:"px-4 py-1 border border-gray-300 text-gray-700 hover:bg-gray-50 rounded-lg text-sm font-semibold transition",children:"Discard"})]})]})]}),i&&r.jsx("div",{className:"mb-4 p-4 bg-gray-100 border border-gray-400 text-gray-800 rounded",children:i}),r.jsxs("form",{onSubmit:ye,className:"bg-white rounded-lg shadow-lg p-4",children:[r.jsx("div",{className:"mb-8",children:r.jsxs("div",{className:"grid gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Product Name *"}),r.jsx("input",{type:"text",value:y.name,onChange:e=>v({...y,name:e.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none",placeholder:"Enter product name"})]}),r.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Price"}),r.jsxs("div",{className:"relative",children:[r.jsx("span",{className:"absolute left-3 top-2.5 text-gray-900",children:"Â£"}),r.jsx("input",{type:"number",step:"0.01",value:y.price,onChange:e=>v({...y,price:e.target.value}),className:"w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none",placeholder:"0.00"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Compare Price"}),r.jsxs("div",{className:"relative",children:[r.jsx("span",{className:"absolute left-3 top-2.5 text-gray-900",children:"Â£"}),r.jsx("input",{type:"number",step:"0.01",value:y.comparePrice,onChange:e=>v({...y,comparePrice:e.target.value}),className:"w-full pl-8 pr-4 py-2 border rounded-lg focus:ring-2 outline-none "+(ue?"border-red-400 focus:ring-red-200":"border-gray-300 focus:ring-gray-800"),placeholder:"0.00"}),ue&&r.jsx("p",{className:"text-xs text-gray-700 mt-1",children:ue})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Stock"}),r.jsx("input",{type:"number",value:y.stock,onChange:e=>v({...y,stock:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none",placeholder:"0"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Slug"}),r.jsx("input",{type:"text",value:y.slug||"",onChange:e=>v({...y,slug:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none",placeholder:"product-url-slug"}),r.jsx("p",{className:"text-xs text-gray-900 mt-1",children:"Auto-generated if empty"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900",children:"Categories"}),r.jsxs("button",{type:"button",onClick:()=>z(!0),className:"inline-flex items-center gap-2 text-sm text-gray-700 bg-gray-100 hover:bg-gray-200 px-3 py-1.5 rounded-full border border-gray-300 shadow-sm hover:shadow","aria-label":"Select categories",children:[r.jsx("i",{className:"fas fa-tags text-gray-700"}),r.jsx("span",{className:"font-medium",children:"Select Categories"})]})]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:(y.categories||[]).map(e=>{const t=(()=>{const e={},t=s=>{if(!s)return;const a=Array.isArray(s)?s:Object.values(s);for(const r of a)r&&r._id&&r.name&&(e[r._id]=r.name),r&&r.subcategories&&t(r.subcategories)};return t(H),e})()[e]||e;return r.jsxs("span",{className:"flex items-center gap-2 bg-white border border-gray-200 px-3 py-1 rounded-full text-sm font-semibold shadow-sm",children:[r.jsx("span",{className:"text-gray-700 text-xs",children:t&&t[0]}),r.jsx("span",{className:"text-indigo-800",children:t}),r.jsx("button",{type:"button",onClick:()=>v({...y,categories:(y.categories||[]).filter(t=>t!==e)}),className:"text-gray-900 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100 transition","aria-label":`Remove category ${t}`,children:r.jsx("i",{className:"fas fa-times",style:{fontSize:"12px"}})})]},`chip-${e}`)})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Description"}),r.jsx(p,{value:y.description,onChange:e=>v({...y,description:e})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Benefits Section Heading"}),r.jsx("input",{type:"text",value:y.benefitsHeading,onChange:e=>v({...y,benefitsHeading:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none mb-4",placeholder:" "}),r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Benefits Description"}),r.jsx(p,{value:y.benefitsText,onChange:e=>v({...y,benefitsText:e})}),r.jsx("p",{className:"text-xs text-gray-900 mt-2",children:"Use the editor to format your benefits with headings, bullets, and bold text. These will be displayed beautifully on the product page."})]})]})}),r.jsxs("div",{className:"mb-8 pb-8 border-b",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Media"}),r.jsxs("div",{className:"grid grid-cols-6 gap-3",children:[r.jsxs("div",{className:"col-span-1",children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Main"}),r.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg overflow-hidden bg-gray-50 w-full aspect-square flex items-center justify-center relative",onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();const t=e.dataTransfer.getData("text/plain");t&&Ae(Number(t),0)},children:y.images&&y.images[0]?r.jsxs("div",{className:"relative w-full h-full",children:[r.jsx("img",{src:Se(y.images[0]),alt:"Main",className:"w-full h-full object-contain"}),r.jsx("button",{type:"button",onClick:()=>Ce(0),className:"absolute top-2 right-2 bg-gray-700 text-white p-1.5 rounded-full hover:bg-[var(--color-accent-primary)]","aria-label":"Remove main image",children:r.jsx("i",{className:"fas fa-times",style:{fontSize:"16px"}})})]}):r.jsxs("label",{className:"flex items-center justify-center w-full h-full cursor-pointer hover:bg-gray-100 transition",children:[r.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=e.target.files;t&&Array.from(t).forEach(async e=>{const t=await we(e);t&&ke(t)})},className:"hidden"}),r.jsxs("div",{className:"flex flex-col items-center gap-2 text-gray-600",children:[r.jsx("i",{className:"fas fa-cloud-upload-alt text-3xl text-gray-700"}),r.jsx("span",{className:"text-xs font-semibold text-center",children:"Drop or click to add images"})]})]})})]}),r.jsxs("div",{className:"col-span-5",children:[r.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Gallery images"}),(()=>{const e=y.images||[],t=e.slice(1,20),s=Math.max(0,e.length-20);return r.jsx("div",{className:"space-y-2",children:r.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.map((e,t)=>{const s=t+1;return r.jsxs("div",{className:"relative group h-20 aspect-square rounded-lg overflow-hidden bg-gray-100 cursor-grab border border-gray-200",draggable:!0,onDragStart:e=>{e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",String(s))},onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault();const t=Number(e.dataTransfer.getData("text/plain"));isNaN(t)||Ae(t,s)},onDoubleClick:()=>Ae(s,0),children:[r.jsx("img",{src:Se(e),alt:`Gallery ${s}`,className:"w-full h-full object-contain"}),r.jsx("button",{type:"button",onClick:()=>Ce(s),className:"absolute top-1 right-1 bg-red-600 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition","aria-label":"Remove image",children:r.jsx("i",{className:"fas fa-times",style:{fontSize:"12px"}})})]},s)}),s>0&&r.jsx("div",{className:"h-20 aspect-square rounded-lg overflow-hidden bg-gray-600 flex items-center justify-center border border-gray-400",children:r.jsxs("span",{className:"text-white font-bold text-lg",children:["+",s]})}),r.jsx("button",{type:"button",onClick:()=>M(!0),className:"flex items-center justify-center h-20 aspect-square rounded-lg border-2 border-dashed border-gray-300 cursor-pointer hover:border-gray-800 transition bg-white",children:r.jsx("span",{className:"text-2xl",children:"ðŸ“"})}),r.jsxs("label",{className:"flex items-center justify-center h-20 aspect-square rounded-lg border-2 border-dashed border-gray-300 cursor-pointer hover:border-gray-800 transition bg-white",children:[r.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{const t=e.target.files;t&&Array.from(t).forEach(async e=>{const t=await we(e);t&&ke(t)})},className:"hidden"}),r.jsx("span",{className:"text-2xl",children:"â¬†ï¸"})]})]})})})()]})]})]}),r.jsxs("div",{className:"mb-8 pb-8 border-b",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Variants & Options"}),r.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4 mb-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("button",{type:"button",onClick:()=>N(e=>!e),className:"flex items-center gap-2",children:[r.jsx("span",{className:"transform transition-transform "+(j?"rotate-90":""),children:r.jsx("i",{className:"fas fa-chevron-right"})}),r.jsx("h3",{className:"text-lg font-bold",children:"Options"})]}),r.jsxs("button",{type:"button",onClick:()=>{v({...y,options:[...y.options,{name:"",values:[]}]})},className:"flex items-center gap-2 bg-[var(--color-accent-primary)] text-white px-3 py-2 rounded-lg text-sm font-medium hover:bg-black","aria-label":"Add option",children:[r.jsx("i",{className:"fas fa-plus",style:{fontSize:"inherit"}}),r.jsx("span",{className:"hidden sm:inline-block",children:"Add Option"})]})]}),j&&0===y.options.length&&r.jsx("p",{className:"text-sm text-gray-900 mb-3",children:"Add an option (e.g., Size, Color) then add its values."}),j&&r.jsx("div",{className:"space-y-3",children:y.options.map((e,t)=>{const s=e.name||`opt-${t}`,a=!!P[s];return r.jsxs("div",{className:"bg-white border rounded p-3",children:[r.jsxs("div",{className:"flex items-center justify-between ",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[r.jsx("button",{type:"button",onClick:()=>{return e=s,V(t=>({...t,[e]:!t[e]}));var e},className:"p-1",children:r.jsx("i",{className:"fas fa-chevron-down",style:{display:"inline-block",transition:"transform 0.2s",transform:a?"rotateZ(0deg)":"rotateZ(-90deg)"}})}),r.jsx("input",{type:"text",value:e.name,onChange:e=>((e,t)=>{const s=y.options[e]&&y.options[e].name||"",a=y.options.map((s,a)=>a===e?{...s,name:t}:s);if(s!==t){const e=(y.variants||[]).map(e=>{const a={...e.optionValues||{}};if(s&&Object.prototype.hasOwnProperty.call(a,s)){const e=a[s];delete a[s],t&&(a[t]=e)}return{...e,optionValues:a}});v({...y,options:a,variants:e})}else v({...y,options:a})})(t,e.target.value),placeholder:"Option name (e.g., Size)",className:"px-3 py-2 border rounded flex-1"})]}),r.jsx("button",{type:"button",onClick:()=>(e=>{const t=y.options[e],s=t?.name,a=y.options.filter((t,s)=>s!==e),r=(y.variants||[]).map(e=>{if(!s)return e;const t={...e.optionValues||{}};return Object.prototype.hasOwnProperty.call(t,s)&&delete t[s],{...e,optionValues:t}});v({...y,options:a,variants:r})})(t),className:"text-gray-700 hover:text-gray-900 px-2 py-1 rounded-md hover:bg-gray-100 transition","aria-label":"Remove option",children:r.jsx("i",{className:"fas fa-trash-alt"})})]}),a&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[r.jsx("input",{type:"text",placeholder:`Add ${e.name||"value"}`,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),fe(t,e.target.value.trim()),e.target.value="")},className:"flex-1 px-3 py-2 border rounded"}),r.jsx("button",{type:"button",onClick:e=>{const s=e.target.closest(".flex")?.querySelector("input");s&&s.value&&(fe(t,s.value.trim()),s.value="")},className:"bg-[var(--color-accent-primary)] text-white px-4 py-2 rounded text-sm font-medium hover:bg-black",children:"Add Value"})]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:e.values.map((e,s)=>r.jsxs("span",{className:"bg-gray-200 text-gray-800 px-3 py-1 rounded-full text-sm inline-flex items-center gap-2",children:[e,r.jsx("button",{type:"button",onClick:()=>{return e=t,a=s,void v(t=>{const s=(t.options||[]).map((t,s)=>{if(s!==e)return t;const r=Array.isArray(t.values)?t.values.filter((e,t)=>t!==a):[];return{...t,values:r}});return{...t,options:s}});var e,a},className:"text-gray-700 hover:text-gray-900 font-bold p-0.5 rounded-full hover:bg-gray-100 transition","aria-label":`Remove value ${e}`,children:r.jsx("i",{className:"fas fa-minus",style:{fontSize:"inherit"}})})]},s))})]})]},t)})}),j&&y.options.length>0&&r.jsx("button",{type:"button",onClick:()=>{(()=>{const e=(y.options||[]).filter(e=>e.name&&Array.isArray(e.values)&&e.values.length>0);if(0===e.length)return void v(e=>({...e,variants:[]}));const t=e.map(e=>e.values).reduce((e,t)=>e.flatMap(e=>t.map(t=>[...e,t])),[[]]).map((t,s)=>{const a={};return t.forEach((t,s)=>{a[e[s].name]=t}),{id:`variant-${Date.now()}-${s}`,optionValues:a,sku:"",price:y.price||"",stock:0,image:""}});v(e=>({...e,variants:t})),k(!0),u.success("Variants generated")})(),k(!0)},className:"mt-4 bg-[var(--color-accent-primary)] text-white px-4 py-2 rounded-lg font-medium hover:bg-black",children:"Generate Variants"})]}),y.variants.length>0&&r.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsxs("button",{type:"button",onClick:()=>k(e=>!e),className:"flex items-center gap-2",children:[r.jsx("span",{className:"transform transition-transform "+(w?"rotate-90":""),children:r.jsx("i",{className:"fas fa-chevron-right"})}),r.jsxs("h3",{className:"text-lg font-bold",children:["Variants (",y.variants.length,")"]})]}),r.jsx("button",{type:"button",onClick:()=>{ve(),k(!0)},className:"bg-[var(--color-accent-primary)] text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-black",children:"Add Variant"})]}),w&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center justify-between gap-4 mb-4",children:[r.jsxs("div",{className:"relative flex-1",children:[r.jsx("i",{className:"fas fa-search absolute left-3 top-3 text-gray-400"}),r.jsx("input",{value:S,onChange:e=>D(e.target.value),placeholder:"Search variants...",className:"w-full pl-10 pr-4 py-2 border rounded-lg"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{className:"text-sm text-gray-600",children:"Group by"}),r.jsx("select",{value:C,onChange:e=>A(e.target.value),className:"px-3 py-2 border rounded-lg",children:y.options.map(e=>e.name?r.jsx("option",{value:e.name,children:e.name},e.name):null)})]})]}),r.jsx("div",{className:"overflow-x-auto",children:r.jsx("div",{className:"space-y-4",children:(()=>{const e={},t=y.variants||[],s=(S||"").trim().toLowerCase();t.forEach(t=>{if(s){if(!`${t.sku||""} ${t.name||""} ${pe(t.optionValues)||""}`.toLowerCase().includes(s))return}const a=t.optionValues&&t.optionValues[C]||"â€”";e[a]||(e[a]=[]),e[a].push(t)});let a=Object.keys(e).sort((e,t)=>String(e).localeCompare(String(t)));return W&&e[W]&&a.includes(W)&&(a=[W,...a.filter(e=>e!==W)]),a.map(t=>{const s=e[t],a=!!T[t],i=xe(t);return r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{type:"button",onClick:()=>(e=>{$(t=>({...t,[e]:!t[e]}))})(t),className:"p-2 "+(a?"rotate-90":""),"aria-expanded":a,children:r.jsx("i",{className:"fas fa-chevron-right"})}),r.jsxs("div",{children:[r.jsx("div",{className:"text-lg font-bold",children:t}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("span",{className:"text-sm text-gray-900",children:[s.length," variant(s)"]})})]})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{className:"text-xs text-gray-600 font-semibold",children:"Price:"}),r.jsx("input",{type:"number",step:"0.01",placeholder:"Price",value:L?.[i]?.price??"",onChange:e=>{he(t,"price",e.target.value),be(t,"price",e.target.value)},className:"w-24 px-2 py-1 border rounded text-sm"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{className:"text-xs text-gray-600 font-semibold",children:"Stock:"}),r.jsx("input",{type:"number",placeholder:"Stock",value:L?.[i]?.stock??"",onChange:e=>{he(t,"stock",e.target.value),be(t,"stock",e.target.value)},className:"w-20 px-2 py-1 border rounded text-sm"})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("label",{className:"flex flex-col items-center gap-2 cursor-pointer group relative h-10 px-3 py-1 border rounded bg-gray-100 hover:bg-gray-200 transition",onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("opacity-75","ring-2","ring-gray-600")},onDragLeave:e=>{e.currentTarget.classList.remove("opacity-75","ring-2","ring-gray-600")},onDrop:e=>{e.preventDefault(),e.currentTarget.classList.remove("opacity-75","ring-2","ring-gray-600");const s=e.dataTransfer.getData("text/plain");if(s&&(s.startsWith("/")||s.startsWith("http")))he(t,"image",s),be(t,"image",s);else if(s&&s.startsWith("data:"))he(t,"image",s),be(t,"image",s);else{const s=e.dataTransfer.files;if(s&&s[0]){const e=s[0];we(e).then(e=>{e&&(he(t,"image",e),be(t,"image",e))})}}},onClick:()=>{U(t),q(!0)},children:r.jsx("span",{className:"text-xs text-gray-700 hover:underline font-semibold",children:"Gallery & Drag"})})}),r.jsxs("button",{type:"button",onClick:()=>ve(),className:"flex items-center gap-2 bg-[var(--color-accent-primary)] text-white px-3 py-1 rounded text-sm font-medium hover:bg-black transition","aria-label":"Add variant to group",children:[r.jsx("i",{className:"fas fa-plus text-xs"}),r.jsx("span",{className:"hidden sm:inline-block",children:"Add Variant"})]})]})]}),a&&r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[ie.map((e,t)=>e.groupKey===i&&le[t]?r.jsxs("div",{className:"col-span-2 bg-gray-100 border border-gray-300 rounded-lg p-3 flex items-center justify-between",children:[r.jsxs("div",{className:"text-sm text-gray-800 font-medium",children:["Variant ",r.jsx("span",{className:"font-semibold",children:pe(e.variant.optionValues)})," deleted"]}),r.jsx("button",{type:"button",onClick:()=>(e=>{if(e<0||e>=ie.length)return;const{variant:t,id:s}=ie[e],a=Math.max(0,Math.min(t.index,y.variants.length));ce.current[s]&&(clearTimeout(ce.current[s]),delete ce.current[s]),v(e=>{const s=Array.isArray(e.variants)?[...e.variants]:[];return s.splice(a,0,t),{...e,variants:s}}),ne(t=>t.filter((t,s)=>s!==e)),oe(t=>t.filter((t,s)=>s!==e)),u("Variant restored",{icon:"â†©ï¸"})})(t),className:"px-4 py-1.5 bg-[var(--color-accent-primary)] hover:bg-black text-white rounded text-sm font-semibold transition",children:"â†©ï¸ Undo"})]},`undo-${e.timestamp}`):null),s.map(e=>{const t=y.variants.findIndex(t=>t.id===e.id);return r.jsxs("div",{className:"relative border border-gray-200 rounded-lg p-3 bg-white flex gap-3 h-full shadow-sm hover:shadow-md transition",children:[r.jsxs("div",{className:"flex-1 flex flex-col ",children:[r.jsx("div",{className:"text-sm text-gray-600 font-medium",children:pe(e.optionValues)}),r.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-900 font-semibold",children:"SKU"}),r.jsx("input",{type:"text",value:e.sku||"",onChange:t=>Ne(e.id,{sku:t.target.value}),placeholder:"SKU",className:"w-full px-2 py-1 border rounded text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-900 font-semibold",children:"Price"}),r.jsx("input",{type:"number",step:"0.01",value:e.price||"",onChange:t=>Ne(e.id,{price:t.target.value}),placeholder:"Price",className:"w-full px-2 py-1 border rounded text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-900 font-semibold",children:"Stock"}),r.jsx("input",{type:"number",value:e.stock||0,onChange:t=>Ne(e.id,{stock:parseInt(t.target.value)||0}),placeholder:"Stock",className:"w-full px-2 py-1 border rounded text-sm"})]})]})]}),r.jsx("div",{className:"flex flex-col gap-2 h-20 w-24",children:r.jsx("label",{className:"flex flex-col gap-2 cursor-pointer group relative h-24",onDragOver:e=>{e.preventDefault(),e.currentTarget.classList.add("opacity-75","ring-2","ring-gray-600")},onDragLeave:e=>{e.currentTarget.classList.remove("opacity-75","ring-2","ring-gray-600")},onDrop:t=>{t.preventDefault(),t.currentTarget.classList.remove("opacity-75","ring-2","ring-gray-600");const s=t.dataTransfer.getData("text/plain");if(s&&(s.startsWith("/")||s.startsWith("http")))Ne(e.id,{image:s});else if(s&&s.startsWith("data:"))Ne(e.id,{image:s});else{const s=t.dataTransfer.files;if(s&&s[0]){const t=s[0];we(t).then(t=>{t&&Ne(e.id,{image:t})})}}},onClick:()=>{K(e),R(!0)},children:e.image?r.jsx("img",{src:Se(e.image),alt:"v",className:"w-full h-full object-cover rounded border border-gray-300 group-hover:opacity-75 transition",onError:e=>{e.target.style.display="none"}}):r.jsx("div",{className:"w-full h-full bg-gray-100 rounded border-2 border-dashed border-gray-300 flex items-center justify-center text-xs text-gray-900 group-hover:bg-gray-50 group-hover:border-blue-400 transition text-center px-1",children:"Drag or Gallery"})})}),r.jsx("button",{type:"button",onClick:()=>((e,t)=>{const s=y.variants.find(t=>t.id===e);if(!s)return;const a=s.optionValues&&s.optionValues[C]||"â€”",r={variant:s,index:t,timestamp:Date.now(),id:e,groupKey:a};ne(e=>[...e,r]),oe(e=>[...e,!0]);const i=setTimeout(()=>{oe(e=>{const t=e.length-1;return e.filter((e,s)=>s!==t)}),ne(e=>{const t=e.length-1;return e.filter((e,s)=>s!==t)}),delete ce.current[e]},54e5);ce.current[e]=i,v(t=>({...t,variants:t.variants.filter(t=>t.id!==e)}))})(e.id,t),className:"absolute top-2 right-2 text-gray-700 hover:text-gray-900 bg-gray-100 hover:bg-gray-200 p-2 rounded-full transition","aria-label":"Delete variant",children:r.jsx("i",{className:"fas fa-trash text-sm"})})]},e.id)})]})]},`group-${i}`)})})()})})]})]})]}),r.jsx(g,{metaTitle:y.metaTitle,metaDescription:y.metaDescription,metaKeywords:y.metaKeywords,onChange:(e,t)=>v({...y,[e]:t}),defaultTitle:y.name}),r.jsxs("div",{className:"flex gap-4 justify-end items-center",children:["saving"===b&&r.jsx("span",{className:"text-sm text-gray-600",children:"Saving..."}),"saved"===b&&r.jsx("span",{className:"text-sm text-green-600 font-semibold",children:"Saved, published"}),r.jsx("button",{type:"button",onClick:()=>{se&&ae?(v(ae),u("Changes discarded",{icon:"â†©ï¸"})):ge(()=>e("/admin/products"))},className:"px-6 py-3 border-2 border-gray-300 text-gray-900 rounded-lg font-semibold hover:bg-gray-50 transition",children:se?"Discard":"Cancel"}),y.isDraft?r.jsxs("button",{type:"button",onClick:()=>ye(null,!1),disabled:s||Boolean(ue),className:"flex items-center gap-2 px-6 py-3 bg-black hover:bg-gray-900 text-white rounded-lg font-semibold transition disabled:opacity-50",children:[r.jsx("i",{className:"fas fa-check"})," ",s?"Saving...":"Save Draft"]}):r.jsxs("button",{type:"submit",disabled:s||Boolean(ue),className:"flex items-center gap-2 px-6 py-3 bg-[var(--color-accent-primary)] hover:bg-black text-white rounded-lg font-semibold transition disabled:opacity-50",children:[r.jsx("i",{className:"fas fa-check"})," ",s?se?"Saving...":"Publishing...":se?"Save":"Publish"]})]})]})]}),r.jsx(De,{show:_,onClose:()=>z(!1)}),r.jsx(Te,{show:B,onClose:()=>M(!1)}),r.jsx($e,{show:F,onClose:()=>{R(!1),K(null)}}),r.jsx(Pe,{show:G,onClose:()=>{q(!1),U(null)}}),r.jsx(Ve,{show:X,onClose:()=>Y(!1)})]})};export{b as default};
