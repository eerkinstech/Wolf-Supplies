import{j as e}from"./editor-BiSlXHWs.js";import{u as r,d as t,a}from"./vendor-0z5P9xg-.js";import{u as o,d as s}from"./redux-DhaBhdiE.js";import{k as n,z as l}from"./index-BiO51Ilc.js";var i,c="clover",d="https://js.stripe.com",u="".concat(d,"/").concat(c,"/stripe.js"),m=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,p=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,h=function(e){return m.test(e)||p.test(e)},g=function(e){var r=document.createElement("script");r.src="".concat(u).concat("");var t=document.head||document.body;if(!t)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return t.appendChild(r),r},x=null,y=null,v=null,b=function(e){return null!==x?x:(x=new Promise(function(r,t){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe)r(window.Stripe);else try{var a=function(){for(var e=document.querySelectorAll('script[src^="'.concat(d,'"]')),r=0;r<e.length;r++){var t=e[r];if(h(t.src))return t}return null}();if(a&&e);else if(a){if(a&&null!==v&&null!==y){var o;a.removeEventListener("load",v),a.removeEventListener("error",y),null===(o=a.parentNode)||void 0===o||o.removeChild(a),a=g()}}else a=g();v=function(e,r){return function(){window.Stripe?e(window.Stripe):r(new Error("Stripe.js not available"))}}(r,t),y=function(e){return function(r){e(new Error("Failed to load Stripe.js",{cause:r}))}}(t),a.addEventListener("load",v),a.addEventListener("error",y)}catch(s){return void t(s)}else r(null)})).catch(function(e){return x=null,Promise.reject(e)})},f=function(){return i||(i=b(null).catch(function(e){return i=null,Promise.reject(e)}))};Promise.resolve().then(function(){return f()}).catch(function(e){});let j=null;const N=()=>{if(j)return j;return j=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];0;var a=Date.now();return f().then(function(e){return function(e,r,t){if(null===e)return null;r[0].match(/^pk_test/),e.version;var a=e.apply(void 0,r);return function(e,r){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"8.5.3",startTime:r})}(a,t),a}(e,r,a)})}("pk_test_51Sd8pH4JIXs43X9UA34kzcfvXzky3k5wvksXMTbho5WHiWr9lYXgf1xZYW85jSwvc7bUv3SuN9TMGmc1TMsDRMID000AhcpMal"),j},w=()=>{const i=o(),c=r(),d=t(),{items:u,totalPrice:m,totalQuantity:p}=s(e=>e.cart),{appliedCoupon:h,discountAmount:g}=d.state||{},x=Math.max(0,(m||0)-(g||0)),y="https://api.wolfsupplies.co.uk",v=e=>{if(!e)return"https://via.placeholder.com/150";if(Array.isArray(e)){const r=e.find(e=>!!e);return v(r)}if("object"==typeof e){const r=e.url||e.secure_url||e.path||e.src||e.public_id||e.location;return r&&"string"==typeof r?r.startsWith("http")?r:`${y}${r}`:"https://via.placeholder.com/150"}return"string"==typeof e?e.startsWith("http")?e:`${y}${e}`:"https://via.placeholder.com/150"},b=r=>{if(!r)return null;const t=[];return r.selectedSize&&t.push(`Size: ${r.selectedSize}`),r.selectedColor&&t.push(`Color: ${r.selectedColor}`),r.selectedVariants&&"object"==typeof r.selectedVariants&&Object.entries(r.selectedVariants).forEach(([e,r])=>{r&&t.push(`${e}: ${r}`)}),0===t.length?null:e.jsx("div",{className:"text-sm text-gray-900",children:t.join(" / ")})},[f,j]=a.useState(""),[w,S]=a.useState(""),[C,E]=a.useState(""),[k,P]=a.useState(""),[I,A]=a.useState(""),[q,F]=a.useState(""),[$,z]=a.useState(""),[R,T]=a.useState(""),[_,O]=a.useState(""),[M,B]=a.useState(""),[V,L]=a.useState(""),[W,D]=a.useState(!1),[J,X]=a.useState(""),[U,Y]=a.useState(""),[G,H]=a.useState(""),[Q,Z]=a.useState(""),[K,ee]=a.useState(""),[re,te]=a.useState(""),[ae,oe]=a.useState(""),[se,ne]=a.useState(""),[le,ie]=a.useState(""),[ce,de]=a.useState(!1),[ue,me]=a.useState(!1),[pe,he]=a.useState("card"),[ge,xe]=a.useState(!1),[ye,ve]=a.useState(null),[be,fe]=a.useState(!1),je=a.useRef(null),Ne=a.useRef(null),we=a.useRef(null),Se=a.useRef(!1),Ce=a.useRef(null);a.useEffect(()=>{try{const e=JSON.parse(localStorage.getItem("checkoutSavedInfo")||"null");e&&(j(e.firstName||""),S(e.lastName||""),E(e.email||""),P(e.phone||""),A(e.address||""),F(e.apartment||""),z(e.city||""),T(e.stateRegion||""),O(e.postalCode||""),B(e.country||""),me(!0))}catch(e){}},[]),a.useEffect(()=>((async()=>{try{const e=await N();if(!e)return;je.current=e;const r=je.current.elements();if(Ne.current=r,!Se.current){const e=r.create("card",{style:{base:{fontSize:"16px",color:"#000000",fontFamily:"system-ui, -apple-system, sans-serif","::placeholder":{color:"#999999"}},invalid:{color:"#EF4444",iconColor:"#EF4444"}}});document.getElementById("card-element")&&(e.mount("#card-element"),we.current=e,Se.current=!0,e.on("change",e=>{const r=document.getElementById("card-errors");r&&(r.textContent=e.error?e.error.message:"",r.style.display=e.error?"block":"none")}))}}catch(e){}})(),()=>{try{we.current&&we.current.unmount()}catch(e){}}),[]),a.useEffect(()=>{je.current&&(async()=>{if(je.current&&0!==u.length)try{const e=je.current.paymentRequest({country:"GB",currency:"gbp",total:{label:"Total",amount:Math.round(100*x)},displayItems:u.map(e=>({label:e.name,amount:Math.round(e.price*e.quantity*100)})),requestPayerName:!0,requestPayerEmail:!0,requestPayerPhone:!0,requestShipping:!0,shippingOptions:[{id:"free",label:"Free Shipping",detail:"2-4 business days",amount:0}]});await e.canMakePayment()&&(ve(e),fe(!0),e.on("paymentmethod",async e=>{try{if(xe(!0),e.payerName){const r=e.payerName.split(" ");j(r[0]||""),S(r.slice(1).join(" ")||"")}e.payerEmail&&E(e.payerEmail),e.payerPhone&&P(e.payerPhone),e.shippingAddress&&(A(e.shippingAddress.addressLine[0]||""),z(e.shippingAddress.city||""),T(e.shippingAddress.region||""),O(e.shippingAddress.postalCode||""),B(e.shippingAddress.country||""));const r={orderItems:u.map(e=>({name:e.name,price:e.price,qty:e.quantity,product:e.product||e._id,image:e.image,variantImage:e.variantImage||null,selectedVariants:e.selectedVariants||null,selectedSize:e.selectedSize||null,selectedColor:e.selectedColor||null,colorCode:e.colorCode||null,variant:e.variant||null,sku:e.sku||null,variantId:e.variantId||e.snapshot?.variantId||null})),shippingAddress:{firstName:e.payerName?.split(" ")[0]||f,lastName:e.payerName?.split(" ").slice(1).join(" ")||w,email:e.payerEmail||C,phone:e.payerPhone||k,address:e.shippingAddress?.addressLine[0]||I,apartment:"",city:e.shippingAddress?.city||$,state:e.shippingAddress?.region||R,postalCode:e.shippingAddress?.postalCode||_,country:e.shippingAddress?.country||M},paymentMethod:"digital_wallet",itemsPrice:m,taxPrice:0,shippingPrice:0,totalAmount:Number(x.toFixed(2)),couponCode:h?.code||null,discountAmount:g||0},t=localStorage.getItem("token"),a=await fetch(`${y}/api/payments/create-payment-intent`,{method:"POST",headers:{"Content-Type":"application/json",...t?{Authorization:`Bearer ${t}`}:{}},credentials:"include",body:JSON.stringify(r)}),o=await a.json();if(!a.ok)throw e.complete("fail"),new Error(o.error||o.message||"Failed to create payment intent");const s=o.clientSecret,d=je.current,p=await d.confirmCardPayment(s,{payment_method:e.paymentMethod.id});if(p.error)throw e.complete("fail"),new Error(p.error.message||"Payment confirmation failed");if("succeeded"!==p.paymentIntent?.status)throw e.complete("fail"),new Error("Payment not completed");{e.complete("success");const r=o.orderId;i(n()),de(!0),setTimeout(()=>{l.success("Payment successful"),c(`/order/${r}`)},1800)}}catch(r){e.complete("fail"),l.error(r.message||"Payment failed"),xe(!1)}}))}catch(e){}})()},[u,x,h,g,i,c]),a.useEffect(()=>{if(ye&&be&&Ne.current)try{const e=Ne.current.create("paymentRequestButton",{paymentRequest:ye}),r=document.getElementById("payment-request-button");r&&0===r.children.length&&(e.mount(r),Ce.current=e)}catch(e){}},[ye,be]);return e.jsxs("div",{className:"min-h-screen bg-[var(--color-bg-section)] py-12 px-4 sm:px-6 lg:px-8",children:[ce&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:e.jsxs("div",{className:"bg-[var(--color-bg-primary)] rounded-lg p-6 shadow-lg max-w-md w-full text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-[var(--color-text-primary)] mb-2",children:"Thank you!"}),e.jsx("p",{className:"text-[var(--color-text-light)] mb-4",children:"Your order has been placed successfully."})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-[var(--color-bg-primary)] rounded-2xl shadow p-8 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-[var(--color-text-primary)]",children:"Contact "}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{placeholder:"First name",value:f,onChange:e=>j(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"}),e.jsx("input",{placeholder:"Last name",value:w,onChange:e=>S(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"}),e.jsx("input",{placeholder:"Email",value:C,onChange:e=>E(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)] md:col-span-2"}),e.jsx("input",{placeholder:"Phone",value:k,onChange:e=>P(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)] md:col-span-2"})]}),e.jsx("h2",{className:"text-2xl font-bold text-[var(--color-text-primary)]",children:"Shipping Address"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("input",{placeholder:"Address (street)",value:I,onChange:e=>A(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)] md:col-span-2"}),e.jsx("input",{placeholder:"Apt, suite (optional)",value:q,onChange:e=>F(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"}),e.jsx("input",{placeholder:"City",value:$,onChange:e=>z(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"}),e.jsx("input",{placeholder:"State / Region",value:R,onChange:e=>T(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"}),e.jsx("input",{placeholder:"Postal Code",value:_,onChange:e=>O(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"}),e.jsx("input",{placeholder:"Country",value:M,onChange:e=>B(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:W,onChange:e=>D(e.target.checked)}),e.jsx("span",{className:"text-sm text-[var(--color-text-light)]",children:"Add separate billing address"})]})}),W&&e.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3",children:[e.jsx("input",{placeholder:"Billing address (street)",value:J,onChange:e=>X(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"}),e.jsx("input",{placeholder:"Apt, suite (optional)",value:U,onChange:e=>Y(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx("input",{placeholder:"City",value:G,onChange:e=>H(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"}),e.jsx("input",{placeholder:"State / Region",value:Q,onChange:e=>Z(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"}),e.jsx("input",{placeholder:"Postal Code",value:K,onChange:e=>ee(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"}),e.jsx("input",{placeholder:"Country",value:re,onChange:e=>te(e.target.value),className:"border border-[var(--color-border-light)] p-3 rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"})]})]}),e.jsx("h2",{className:"text-2xl font-bold text-[var(--color-text-primary)]",children:"Payment"}),e.jsxs("div",{className:"space-y-4",children:[be&&e.jsxs("div",{className:"p-4 border-2 border-[var(--color-border-light)] rounded-lg bg-[var(--color-bg-section)]",children:[e.jsx("p",{className:"text-sm text-[var(--color-text-light)] mb-3",children:"Express Checkout"}),e.jsx("div",{id:"payment-request-button"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center","aria-hidden":"true",children:e.jsx("div",{className:"w-full border-t border-[var(--color-border-light)]"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-[var(--color-bg-primary)] text-[var(--color-text-light)]",children:"Or pay with card"})})]}),e.jsx("div",{className:"",children:e.jsx("input",{placeholder:"Name on card",value:V,onChange:e=>L(e.target.value),className:"border border-[var(--color-border-light)] p-3 w-full rounded bg-[var(--color-bg-primary)] text-[var(--color-text-primary)]"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--color-text-light)] mb-2",children:"Card details"}),e.jsx("div",{id:"card-element",className:"border-2 border-[var(--color-border-light)] p-4 rounded-lg bg-[var(--color-bg-primary)] min-h-12 focus-within:border-[var(--color-accent-primary)] focus-within:ring-2 focus-within:ring-[var(--color-accent-primary)] focus-within:ring-opacity-30 transition-all duration-200"}),e.jsx("div",{id:"card-errors",role:"alert",className:"text-red-500 text-sm mt-2 font-medium"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{id:"saveDetails",type:"checkbox",checked:ue,onChange:e=>me(e.target.checked)}),e.jsx("label",{htmlFor:"saveDetails",className:"text-sm text-[var(--color-text-light)]",children:"Save my details for future purchases"})]})]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"bg-[var(--color-bg-primary)] rounded-2xl shadow p-6 space-y-6 sticky top-24",children:[e.jsx("h3",{className:"text-xl font-bold text-[var(--color-text-primary)]",children:"Order Summary"}),e.jsx("div",{className:"space-y-3 max-h-60 overflow-y-auto",children:u.map(r=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:v(r.image),alt:r.name,className:"w-12 h-12 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:r.name}),b(r),e.jsxs("div",{className:"text-sm text-gray-900 mt-1",children:["Qty: ",r.quantity]})]})]}),e.jsxs("div",{className:"font-semibold",children:["£",(r.price*r.quantity).toFixed(2)]})]},r._id))}),e.jsxs("div",{className:"pt-4 border-t space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Items"}),e.jsxs("span",{children:["£",m.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"Shipping"}),e.jsx("span",{children:"£0.00"})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"VAT"}),e.jsx("span",{children:"£0.00"})]}),g>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600 font-semibold",children:[e.jsxs("span",{children:["Discount ",h?.code?`(${h.code})`:""]}),e.jsxs("span",{children:["-£",g.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg text-[var(--color-text-primary)]",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["£",x.toFixed(2)]})]})]}),e.jsx("button",{onClick:async()=>{if(0!==u.length)if(f&&w&&C&&k&&I&&$&&_&&R){u.map(e=>({product:e._id,qty:e.quantity,price:e.price,name:e.name,image:e.image})),Number(x.toFixed(2));try{if(xe(!0),ue){const e={firstName:f,lastName:w,email:C,phone:k,address:I,apartment:q,city:$,stateRegion:R,postalCode:_,country:M};localStorage.setItem("checkoutSavedInfo",JSON.stringify(e))}else localStorage.removeItem("checkoutSavedInfo");const e={orderItems:u.map(e=>({name:e.name,price:e.price,qty:e.quantity,product:e.product||e._id,image:e.image,variantImage:e.variantImage||null,selectedVariants:e.selectedVariants||null,selectedSize:e.selectedSize||null,selectedColor:e.selectedColor||null,colorCode:e.colorCode||null,variant:e.variant||null,sku:e.sku||null,variantId:e.variantId||e.snapshot?.variantId||null})),shippingAddress:{address:I,apartment:q,city:$,stateRegion:R,postalCode:_,country:M,firstName:f,lastName:w,email:C,phone:k},billingAddress:W?{address:J,apartment:U,city:G,stateRegion:Q,postalCode:K,country:re}:null,paymentMethod:pe,itemsPrice:m,taxPrice:0,shippingPrice:Number((0).toFixed(2)),totalAmount:Number(x.toFixed(2)),couponCode:h?.code||null,discountAmount:g||0},r=await(async()=>{if(je.current&&we.current)return!0;try{const e=await N();if(!e)return!1;if(je.current=e,!we.current){const e=je.current.elements();Ne.current=e;const r=e.create("card",{style:{base:{fontSize:"16px",color:"#000000",fontFamily:"system-ui, -apple-system, sans-serif","::placeholder":{color:"#999999"}},invalid:{color:"#EF4444",iconColor:"#EF4444"}}});document.getElementById("card-element")&&(r.mount("#card-element"),we.current=r,Se.current=!0,r.on("change",e=>{const r=document.getElementById("card-errors");r&&(r.textContent=e.error?e.error.message:"",r.style.display=e.error?"block":"none")}))}return!0}catch(e){return!1}})();if(!r){const r=localStorage.getItem("token"),t=await fetch("https://api.wolfsupplies.co.uk/api/payments/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json",...r?{Authorization:`Bearer ${r}`}:{}},credentials:"include",body:JSON.stringify(e)}),a=await t.json();if(!t.ok)throw new Error(a.error||a.message||"Failed to create checkout session");if(a&&a.url)return void(window.location.href=a.url);throw new Error("No checkout URL from server")}const t=localStorage.getItem("token"),a=await fetch("https://api.wolfsupplies.co.uk/api/payments/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json",...t?{Authorization:`Bearer ${t}`}:{}},credentials:"include",body:JSON.stringify(e)}),o=await a.json();if(!a.ok){const e=o.error||o.message||"Failed to create payment intent";throw new Error(e)}const s=o.clientSecret;if(!s)throw new Error("Missing clientSecret from payment API");const d=je.current,p=we.current;if(!d||!p)throw new Error("Stripe Card Element not initialized");const y=await d.confirmCardPayment(s,{payment_method:{card:p,billing_details:{name:`${f} ${w}`.trim()||void 0,email:C||void 0,phone:k||void 0}}});if(y.error)throw new Error(y.error.message||"Payment confirmation failed");if(!y.paymentIntent)throw new Error("No payment intent returned");if("succeeded"!==y.paymentIntent.status)throw"requires_action"===y.paymentIntent.status?new Error("Payment requires additional authentication. Please complete the verification."):new Error("Payment not completed. Status: "+y.paymentIntent.status);{const e=o.orderId;i(n()),de(!0),setTimeout(()=>{l.success("Payment successful"),c(`/order/${e}`)},1800)}}catch(e){l.error(e.message||"Error creating Stripe session")}finally{xe(!1)}}else l.error("Please complete all required fields");else l.error("Cart is empty")},disabled:ge,className:"w-full bg-[var(--color-accent-primary)] hover:bg-[var(--color-accent-light)] text-white py-3 rounded-lg font-bold shadow transition duration-300",children:ge?"Placing Order…":`Place Order — £${x.toFixed(2)}`}),e.jsx("p",{className:"text-xs text-[var(--color-text-light)]",children:"We do not store your CVV. Saved details are stored locally in your browser."})]})})]})]})};export{w as default};
