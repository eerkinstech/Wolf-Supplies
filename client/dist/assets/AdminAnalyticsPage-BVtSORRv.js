import{j as e}from"./editor-BiSlXHWs.js";import{a as t}from"./vendor-0z5P9xg-.js";import{u as r,d as a}from"./redux-DhaBhdiE.js";import{A as l}from"./AdminLayout-Cnhsu9ug.js";import{f as o,q as s}from"./index-BiO51Ilc.js";const c=()=>{const c=r(),{products:d}=a(e=>e.product),{orders:n=[]}=a(e=>e.order),[i,u]=t.useState(""),[m,x]=t.useState(""),[y,p]=t.useState(!1),[h,b]=t.useState("today"),[v,g]=t.useState("all"),[f,j]=t.useState("all"),[N,S]=t.useState("all"),[w,C]=t.useState("all"),[D,k]=t.useState(null),[O,I]=t.useState("asc"),[A,V]=t.useState({totalSales:0,totalOrders:0,totalProducts:0,avgOrderValue:0,salesByProduct:[],bestSellingByCount:[],bestSellingByQuantity:[],productsByItemsSold:[],productsByGrossValue:[],productOrderCountByProduct:{},variantQtyMap:{}}),[Q,B]=t.useState(null),[E,F]=t.useState({});t.useEffect(()=>{const e=(new Date).toISOString().split("T")[0];u(e),x(e)},[]);return t.useEffect(()=>{c(o()),c(s())},[c]),t.useEffect(()=>{if(d&&n&&n.length>0){const e=e=>{if(!e)return null;const t=new Date(e);if(isNaN(t))return null;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},t=e(i),r=e(m),a=(n||[]).filter(a=>{if(!t&&!r)return!0;const l=e(a.createdAt);return!!l&&(t&&r?l>=t&&l<=r:t?l>=t:!r||l<=r)}),l=a.reduce((e,t)=>e+(t.totalPrice||0),0),o=a.length,s=o>0?(l/o).toFixed(2):0,c={},u={},x={},y={},p={};a.forEach(e=>{e.orderItems&&Array.isArray(e.orderItems)&&e.orderItems.forEach(e=>{const t=e.product||e._id;p[t]||(p[t]=0),p[t]+=1})}),a.forEach(e=>{e.orderItems&&Array.isArray(e.orderItems)&&e.orderItems.forEach(e=>{const t=e.product||e._id,r=e.qty||1,a=e.price||0,l=e.variant||null;if(c[t]||(c[t]={name:e.name,sales:0,price:a,id:t,variants:[]}),u[t]||(u[t]={name:e.name,count:0,id:t,itemsSold:0}),x[t]||(x[t]={name:e.name,quantity:0,id:t}),y[t]||(y[t]=[]),l){y[t].find(e=>JSON.stringify(e)===JSON.stringify(l))||y[t].push(l)}c[t].sales+=a*r,c[t].grossValue=c[t].sales||0,u[t].count+=1,u[t].itemsSold+=r,x[t].quantity+=r})}),Object.keys(c).forEach(e=>{c[e].variants=y[e]||[]});const h=Object.values(c).sort((e,t)=>t.sales-e.sales).slice(0,8),b=Object.values(u).sort((e,t)=>t.count-e.count).slice(0,8),v=Object.values(x).sort((e,t)=>t.quantity-e.quantity).slice(0,8),g=Object.values(u).sort((e,t)=>t.itemsSold-e.itemsSold).slice(0,10),f=Object.values(c).sort((e,t)=>(t.grossValue||0)-(e.grossValue||0)).slice(0,10),j={};a.forEach(e=>{e.orderItems&&Array.isArray(e.orderItems)&&e.orderItems.forEach(e=>{let t=null;if("object"==typeof e.product&&e.product?._id?t=String(e.product._id):"string"==typeof e.product?t=e.product:e._id&&(t=String(e._id)),t&&e.selectedVariants&&"object"==typeof e.selectedVariants&&!Array.isArray(e.selectedVariants)&&Object.keys(e.selectedVariants).length>0&&Object.values(e.selectedVariants).some(e=>e&&""!==String(e).trim())){const r=JSON.stringify(e.selectedVariants);j[t]||(j[t]={}),j[t][r]||(j[t][r]={variant:e.selectedVariants,quantity:0}),j[t][r].quantity+=e.qty||1}})}),V({totalSales:l.toFixed(2),totalOrders:o,totalProducts:d.length,avgOrderValue:s,salesByProduct:h,bestSellingByCount:b,bestSellingByQuantity:v,productsByItemsSold:g,productsByGrossValue:f,filteredOrders:a,productOrderCountByProduct:p,variantQtyMap:j})}},[d,n,i,m]),e.jsx(l,{activeTab:"analytics",children:e.jsxs("div",{className:"p-8",children:[e.jsx("h1",{className:"text-3xl font-bold",style:{color:"var(--color-text-primary)"},children:"Analytics Dashboard"}),e.jsx("p",{className:"mt-4",style:{color:"var(--color-text-light)"},children:"View sales, revenue, and performance metrics"}),e.jsxs("div",{className:"mb-6 rounded-lg p-4 shadow mt-6",style:{backgroundColor:"var(--color-bg-primary)"},children:[e.jsxs("button",{onClick:()=>p(!y),className:"text-sm font-semibold mb-3 px-3 py-1.5 rounded",style:{backgroundColor:"var(--color-bg-section)",color:"var(--color-text-primary)"},children:[e.jsx("i",{className:"fas fa-calendar mr-1 inline"})," ",y?"Hide":"Show"," Date Filter"]}),y&&e.jsxs("div",{className:"flex gap-4 mt-4",children:[e.jsxs("div",{className:"w-48 border-r",style:{borderColor:"var(--color-border-light)"},children:[e.jsx("div",{className:"text-xs font-semibold mb-2",style:{color:"var(--color-text-light)"},children:"QUICK SELECT"}),e.jsx("div",{className:"space-y-1",children:[{label:"Today",value:"today"},{label:"Yesterday",value:"yesterday"},{label:"Last 30 minutes",value:"last30m"},{label:"Last 12 hours",value:"last12h"},{label:"Last 7 days",value:"last7d"},{label:"Last 30 days",value:"last30d"},{label:"Last 90 days",value:"last90d"},{label:"Last 365 days",value:"last365d"},{label:"Last 12 months",value:"last12m"},{label:"Last week",value:"lastweek"},{label:"Last month",value:"lastmonth"}].map(t=>e.jsxs("button",{onClick:()=>(e=>{b(e);const t=new Date;let r,a;switch(e){case"today":r=new Date(t),r.setHours(0,0,0,0),a=new Date(t),a.setHours(23,59,59,999);break;case"yesterday":r=new Date(t),r.setDate(r.getDate()-1),r.setHours(0,0,0,0),a=new Date(r),a.setHours(23,59,59,999);break;case"last30m":r=new Date(t.getTime()-18e5),a=new Date(t);break;case"last12h":r=new Date(t.getTime()-432e5),a=new Date(t);break;case"last7d":r=new Date(t),r.setDate(r.getDate()-7),a=new Date(t);break;case"last30d":r=new Date(t),r.setDate(r.getDate()-30),a=new Date(t);break;case"last90d":r=new Date(t),r.setDate(r.getDate()-90),a=new Date(t);break;case"last365d":r=new Date(t),r.setDate(r.getDate()-365),a=new Date(t);break;case"lastweek":r=new Date(t),r.setDate(r.getDate()-r.getDay()-7),a=new Date(r),a.setDate(a.getDate()+6);break;case"lastmonth":r=new Date(t.getFullYear(),t.getMonth()-1,1),a=new Date(t.getFullYear(),t.getMonth(),0);break;case"last12m":r=new Date(t),r.setFullYear(r.getFullYear()-1),a=new Date(t);break;default:r=new Date(t),r.setHours(0,0,0,0),a=new Date(t)}u(r.toISOString().split("T")[0]),x(a.toISOString().split("T")[0])})(t.value),className:"w-full text-left text-xs py-1.5 px-2 rounded transition",style:{backgroundColor:h===t.value?"var(--color-accent-primary)":"transparent",color:h===t.value?"white":"var(--color-text-primary)"},children:[h===t.value&&"âœ“ ",t.label]},t.value))})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex gap-4 mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-semibold block mb-1",style:{color:"var(--color-text-light)"},children:"From"}),e.jsx("input",{type:"date",value:i,onChange:e=>u(e.target.value),className:"w-full px-2.5 py-1 text-xs rounded",style:{borderColor:"var(--color-border-light)",borderWidth:"1px",backgroundColor:"var(--color-bg-section)"}})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs font-semibold block mb-1",style:{color:"var(--color-text-light)"},children:"To"}),e.jsx("input",{type:"date",value:m,onChange:e=>x(e.target.value),className:"w-full px-2.5 py-1 text-xs rounded",style:{borderColor:"var(--color-border-light)",borderWidth:"1px",backgroundColor:"var(--color-bg-section)"}})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{p(!1),u(""),x(""),b("")},className:"px-3 py-1 text-xs rounded font-semibold",style:{backgroundColor:"var(--color-bg-section)",color:"var(--color-text-primary)"},children:"Cancel"}),e.jsx("button",{onClick:()=>p(!1),className:"px-3 py-1 text-xs rounded font-semibold text-white",style:{backgroundColor:"var(--color-accent-primary)"},children:"Apply"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mt-8",children:[e.jsxs("div",{className:"rounded-lg shadow p-6",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border-light)",borderWidth:"1px"},children:[e.jsx("h3",{className:"text-sm font-semibold uppercase",style:{color:"var(--color-text-secondary)"},children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold mt-2",style:{color:"var(--color-accent-primary)"},children:["Â£",A.totalSales]}),e.jsx("p",{className:"text-sm mt-2",style:{color:"var(--color-text-light)"},children:"All time revenue"})]}),e.jsxs("div",{className:"rounded-lg shadow p-6",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border-light)",borderWidth:"1px"},children:[e.jsx("h3",{className:"text-sm font-semibold uppercase",style:{color:"var(--color-text-secondary)"},children:"Total Orders"}),e.jsx("p",{className:"text-3xl font-bold mt-2",style:{color:"var(--color-text-primary)"},children:A.totalOrders}),e.jsx("p",{className:"text-sm mt-2",style:{color:"var(--color-text-light)"},children:"Complete orders"})]}),e.jsxs("div",{className:"rounded-lg shadow p-6",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border-light)",borderWidth:"1px"},children:[e.jsx("h3",{className:"text-sm font-semibold uppercase",style:{color:"var(--color-text-secondary)"},children:"Total Products"}),e.jsx("p",{className:"text-3xl font-bold mt-2",style:{color:"var(--color-text-primary)"},children:A.totalProducts}),e.jsx("p",{className:"text-sm mt-2",style:{color:"var(--color-text-light)"},children:"In catalog"})]}),e.jsxs("div",{className:"rounded-lg shadow p-6",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border-light)",borderWidth:"1px"},children:[e.jsx("h3",{className:"text-sm font-semibold uppercase",style:{color:"var(--color-text-secondary)"},children:"Avg. Order Value"}),e.jsxs("p",{className:"text-3xl font-bold mt-2",style:{color:"var(--color-text-primary)"},children:["Â£",A.avgOrderValue]}),e.jsx("p",{className:"text-sm mt-2",style:{color:"var(--color-text-light)"},children:"Average per order"})]})]}),e.jsxs("div",{className:"rounded-lg shadow p-6 mt-8 w-full",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border-light)",borderWidth:"1px"},children:[e.jsx("h2",{className:"text-lg font-bold mb-4",style:{color:"var(--color-text-primary)"},children:"ðŸ“‹ Orders Details"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderColor:"var(--color-border-light)",borderBottomWidth:"1px"},children:[e.jsx("th",{className:"text-left py-2 px-3 font-semibold",style:{color:"var(--color-text-primary)"},children:"Product Name"}),e.jsxs("th",{className:"text-right py-2 px-3 font-semibold cursor-pointer hover:underline",style:{color:"var(--color-text-primary)"},onClick:()=>{"gross"===D?I("asc"===O?"desc":"asc"):(k("gross"),I("asc"))},children:["Gross Sale"," ",e.jsx("span",{style:{color:"gross"===D&&"asc"===O?"#000":"#ccc"},children:"â–²"}),e.jsx("span",{style:{color:"gross"===D&&"desc"===O?"#000":"#ccc"},children:"â–¼"})]}),e.jsxs("th",{className:"text-center py-2 px-3 font-semibold cursor-pointer hover:underline",style:{color:"var(--color-text-primary)"},onClick:()=>{"orders"===D?I("asc"===O?"desc":"asc"):(k("orders"),I("asc"))},children:["Orders"," ",e.jsx("span",{style:{color:"orders"===D&&"asc"===O?"#000":"#ccc"},children:"â–²"}),e.jsx("span",{style:{color:"orders"===D&&"desc"===O?"#000":"#ccc"},children:"â–¼"})]}),e.jsx("th",{className:"text-left py-2 px-3 font-semibold",style:{color:"var(--color-text-primary)"},children:"Date"})]})}),e.jsx("tbody",{children:A.filteredOrders&&A.filteredOrders.length>0?(()=>{const t={};A.filteredOrders.forEach(e=>{e.orderItems&&Array.isArray(e.orderItems)&&e.orderItems.forEach(r=>{let a=null;"object"==typeof r.product&&r.product?._id?a=String(r.product._id):"string"==typeof r.product?a=r.product:r._id&&(a=String(r._id));const l=r.name||"Unknown Product",o=`${a}-${l}`;t[o]||(t[o]={id:a,name:l,price:r.price||0,totalQty:0,totalSale:0,orderCount:0,lastDate:e.createdAt,orderIds:new Set});const s=r.qty||1;t[o].totalQty+=s,t[o].totalSale+=(r.price||0)*s,t[o].orderIds.has(String(e._id))||(t[o].orderIds.add(String(e._id)),t[o].orderCount+=1),new Date(e.createdAt)>new Date(t[o].lastDate)&&(t[o].lastDate=e.createdAt)})});const r="all"===v?0:parseFloat(v),a="all"===f?1/0:parseFloat(f),l="all"===N?0:parseInt(N,10),o="all"===w?1/0:parseInt(w,10);return Object.values(t).sort((e,t)=>"gross"===D?"asc"===O?e.totalSale-t.totalSale:t.totalSale-e.totalSale:"orders"===D?"asc"===O?e.orderCount-t.orderCount:t.orderCount-e.orderCount:"all"!==v&&"all"===f?e.totalSale-t.totalSale:"all"!==f&&"all"===v?t.totalSale-e.totalSale:"all"!==N&&"all"===w?e.orderCount-t.orderCount:"all"!==w&&"all"===N?t.orderCount-e.orderCount:t.totalSale-e.totalSale).filter(e=>{const t=parseFloat(e.totalSale)||0,s=parseInt(e.orderCount,10)||0;return t>=r&&t<=a&&s>=l&&s<=o}).map(t=>e.jsxs("tr",{style:{borderColor:"var(--color-border-light)",borderBottomWidth:"1px"},children:[e.jsx("td",{className:"py-2 px-3",style:{color:"var(--color-accent-primary)",cursor:A.variantQtyMap[t.id]&&Object.values(A.variantQtyMap[t.id]).length>0?"pointer":"default"},onClick:()=>{const e=A.variantQtyMap[t.id],r=e?Object.values(e):[];r&&r.length>0&&r.every(e=>e&&"number"==typeof e.quantity&&e.quantity>0)?(B({id:t.id,name:t.name}),F(e||{})):(B(null),F({}))},children:e.jsx("span",{className:A.variantQtyMap[t.id]&&Object.values(A.variantQtyMap[t.id]).length>0?"font-semibold hover:underline":"font-semibold",children:t.name})}),e.jsxs("td",{className:"py-2 px-3 text-right font-bold",style:{color:"#10b981"},children:["Â£",t.totalSale.toFixed(2)]}),e.jsx("td",{className:"py-2 px-3 text-center font-semibold",style:{color:"var(--color-accent-primary)"},children:t.orderCount}),e.jsx("td",{className:"py-2 px-3",style:{color:"var(--color-text-light)"},children:t.lastDate?new Date(t.lastDate).toLocaleDateString():"N/A"})]},`${t.id}-${t.name}`))})():e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"py-4 text-center",style:{color:"var(--color-text-light)"},children:"No orders found for the selected period"})})})]})})]}),Q&&A.variantQtyMap&&A.variantQtyMap[Q.id]&&Object.keys(A.variantQtyMap[Q.id]).length>0&&E&&Object.keys(E).length>0&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-md w-full mx-4",style:{backgroundColor:"var(--color-bg-primary)"},children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-lg font-bold",style:{color:"var(--color-text-primary)"},children:[Q.name," - Variants"]}),e.jsx("button",{onClick:()=>{B(null),F({})},className:"text-2xl font-bold",style:{color:"var(--color-text-light)"},children:"Ã—"})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:Object.values(E).length>0?Object.values(E).map((t,r)=>{const a="object"==typeof t.variant?Object.entries(t.variant).map(([e,t])=>`${e}: ${t}`).join(", "):t.variant;return e.jsxs("div",{className:"flex justify-between items-center p-3 rounded border",style:{borderColor:"var(--color-border-light)",backgroundColor:"var(--color-bg-section)"},children:[e.jsx("span",{style:{color:"var(--color-text-primary)"},children:a||"Default"}),e.jsxs("span",{className:"font-bold px-3 py-1 rounded",style:{backgroundColor:"var(--color-accent-primary)",color:"white"},children:[t.quantity,"x"]})]},r)}):e.jsx("p",{style:{color:"var(--color-text-light)"},children:"No variant data available"})}),e.jsx("button",{onClick:()=>{B(null),F({})},className:"w-full mt-4 py-2 rounded font-semibold text-white",style:{backgroundColor:"var(--color-accent-primary)"},children:"Close"})]})})]})})};export{c as default};
