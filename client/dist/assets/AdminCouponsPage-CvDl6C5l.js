import{j as e}from"./editor-BiSlXHWs.js";import{a as t}from"./vendor-0z5P9xg-.js";import{A as s}from"./AdminLayout-Cnhsu9ug.js";import{z as a}from"./index-BiO51Ilc.js";import"./redux-DhaBhdiE.js";const r="https://api.wolfsupplies.co.uk",l=()=>{const[s,l]=t.useState([]),[n,o]=t.useState(!1),[i,c]=t.useState(""),[d,x]=t.useState(!1),[u,p]=t.useState(null),[m,g]=t.useState([]),[h,y]=t.useState(""),[f,b]=t.useState(!1),[j,v]=t.useState({code:"",description:"",discountType:"percentage",discountValue:0,productId:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0,minimumOrderValue:0}),N=async()=>{o(!0);try{const e=localStorage.getItem("token"),t=await fetch(`${r}/api/coupons`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error("Failed to fetch coupons");const s=await t.json();l(s)}catch(e){a.error(e.message)}finally{o(!1)}};t.useEffect(()=>{N(),(async()=>{try{const e=await fetch(`${r}/api/products`);if(!e.ok)throw new Error("Failed to fetch products");const t=await e.json(),s=Array.isArray(t)?t:t.data||t.products||[];g(s)}catch(e){a.error(e.message),g([])}})()},[]);const w=s.filter(e=>e.code.toLowerCase().includes(i.toLowerCase())||e.description.toLowerCase().includes(i.toLowerCase())),C=e=>e.maxUses&&e.currentUses>=e.maxUses,k=t=>t.isActive?(e=>!!e.validUntil&&new Date(e.validUntil)<new Date)(t)?e.jsxs("span",{className:"bg-red-100 text-red-800 px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-exclamation-triangle"})," Expired"]}):C(t)?e.jsxs("span",{className:"bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1",children:[e.jsx("i",{className:"fas fa-exclamation-triangle"})," Limit Reached"]}):e.jsx("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-semibold",children:"Active"}):e.jsx("span",{className:"bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-xs font-semibold",children:"Inactive"}),U=e=>{const{name:t,value:s,type:a,checked:r}=e.target;v({...j,[t]:"checkbox"===a?r:s})},S=()=>{v({code:"",description:"",discountType:"percentage",discountValue:0,productId:"",maxUses:"",validFrom:"",validUntil:"",isActive:!0,minimumOrderValue:0}),y(""),b(!1),p(null)};return e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Coupon Management"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>N(),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold transition",title:"Refresh coupon list",children:[e.jsx("i",{className:"fas fa-sync"})," Refresh"]}),e.jsxs("button",{onClick:()=>{S(),x(!0)},className:"flex items-center gap-2 bg-gray-800 hover:bg-black text-white px-6 py-2 rounded-lg font-semibold transition",children:[e.jsx("i",{className:"fas fa-plus"})," Create Coupon"]})]})]}),e.jsxs("div",{className:"mb-6 relative w-80",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400",children:e.jsx("i",{className:"fas fa-search text-sm"})}),e.jsx("input",{type:"text",placeholder:"Search coupons...",value:i,onChange:e=>c(e.target.value),className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none"}),i&&e.jsx("button",{onClick:()=>c(""),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:e.jsx("i",{className:"fas fa-times text-sm"})})]}),n&&e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("i",{className:"fas fa-spinner animate-spin text-4xl text-gray-700"})}),!n&&e.jsx("div",{className:"bg-white rounded-lg shadow-lg overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-3 text-left text-xs font-semibold text-gray-900 whitespace-nowrap",children:"Code"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-semibold text-gray-900 whitespace-nowrap",children:"Discount"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-semibold text-gray-900 whitespace-nowrap",children:"Description"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-semibold text-gray-900 whitespace-nowrap",children:"Product"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-semibold text-gray-900 whitespace-nowrap",children:"Usage"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-semibold text-gray-900 whitespace-nowrap",children:"Valid Until"}),e.jsx("th",{className:"px-3 py-3 text-left text-xs font-semibold text-gray-900 whitespace-nowrap",children:"Status"}),e.jsx("th",{className:"px-3 py-3 text-center text-xs font-semibold text-gray-900 whitespace-nowrap",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y",children:w.length>0?w.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-3 py-3 font-mono font-bold text-sm text-gray-900 whitespace-nowrap",children:t.code}),e.jsx("td",{className:"px-3 py-3 text-sm font-semibold text-gray-900 whitespace-nowrap",children:"percentage"===t.discountType?`${t.discountValue}%`:`£${t.discountValue.toFixed(2)}`}),e.jsx("td",{className:"px-3 py-3 text-sm text-gray-700 max-w-xs truncate",children:t.description||"-"}),e.jsx("td",{className:"px-3 py-3 text-sm text-gray-700 max-w-xs truncate",children:t.productId?.name?e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium whitespace-nowrap",title:t.productId.name,children:t.productId.name.length>15?t.productId.name.substring(0,15)+"...":t.productId.name}):e.jsx("span",{className:"text-gray-500 text-xs italic",children:"All"})}),e.jsx("td",{className:"px-3 py-3 text-sm text-gray-900",children:t.maxUses?e.jsxs("div",{className:"flex items-center gap-1 whitespace-nowrap",children:[e.jsxs("span",{className:"font-semibold text-xs",children:[t.currentUses||0,"/",t.maxUses]}),e.jsx("div",{className:"w-16 bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"h-1.5 rounded-full transition-all "+(C(t)?"bg-red-500":"bg-green-500"),style:{width:`${Math.min((t.currentUses||0)/t.maxUses*100,100)}%`}})})]}):e.jsx("span",{className:"text-gray-500 text-xs italic",children:"Unlimited"})}),e.jsx("td",{className:"px-3 py-3 text-xs text-gray-700 whitespace-nowrap",children:t.validUntil?new Date(t.validUntil).toLocaleDateString():"No limit"}),e.jsx("td",{className:"px-3 py-3 text-sm",children:k(t)}),e.jsx("td",{className:"px-3 py-3 text-center",children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{onClick:()=>(e=>{p(e),v({code:e.code,description:e.description||"",discountType:e.discountType,discountValue:e.discountValue,productId:e.productId?._id||"",maxUses:e.maxUses||"",validFrom:e.validFrom?new Date(e.validFrom).toISOString().split("T")[0]:"",validUntil:e.validUntil?new Date(e.validUntil).toISOString().split("T")[0]:"",isActive:e.isActive,minimumOrderValue:e.minimumOrderValue||0}),x(!0)})(t),className:"inline-flex items-center justify-center w-8 h-8 bg-blue-100 text-blue-700 hover:bg-blue-200 transition rounded-md",title:"Edit coupon",children:e.jsx("i",{className:"fas fa-edit",style:{fontSize:"14px"}})}),e.jsx("button",{onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this coupon?"))try{const t=localStorage.getItem("token");if(!(await fetch(`${r}/api/coupons/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok)throw new Error("Failed to delete coupon");a.success("Coupon deleted successfully"),N()}catch(t){a.error(t.message)}})(t._id),className:"inline-flex items-center justify-center w-8 h-8 bg-red-100 text-red-700 hover:bg-red-200 transition rounded-md",title:"Delete coupon",children:e.jsx("i",{className:"fas fa-trash",style:{fontSize:"14px"}})})]})})]},t._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"px-6 py-8 text-center text-gray-600",children:"No coupons found"})})})]})}),d&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",onClick:()=>b(!1),children:e.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-auto",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:u?"Edit Coupon":"Create New Coupon"}),e.jsx("button",{onClick:()=>{x(!1),S()},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),e.jsxs("form",{onSubmit:async e=>{e.preventDefault();try{const e=localStorage.getItem("token");if(!j.code.trim())return void a.error("Coupon code is required");if("percentage"===j.discountType&&(j.discountValue<0||j.discountValue>100))return void a.error("Percentage must be between 0 and 100");const t=u?`${r}/api/coupons/${u._id}`:`${r}/api/coupons`,s=u?"PUT":"POST",l=await fetch(t,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({...j,discountValue:parseFloat(j.discountValue),minimumOrderValue:parseFloat(j.minimumOrderValue),maxUses:j.maxUses?parseInt(j.maxUses):null,productId:j.productId||null})});if(!l.ok){const e=await l.json();throw new Error(e.message)}a.success(u?"Coupon updated successfully":"Coupon created successfully"),N(),S(),x(!1)}catch(t){a.error(t.message)}},className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Coupon Code *"}),e.jsx("input",{type:"text",name:"code",value:j.code,onChange:U,placeholder:"e.g., SUMMER20",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none",disabled:u})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Description"}),e.jsx("input",{type:"text",name:"description",value:j.description,onChange:U,placeholder:"e.g., Summer Sale Discount",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Discount Type *"}),e.jsxs("select",{name:"discountType",value:j.discountType,onChange:U,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none",children:[e.jsx("option",{value:"percentage",children:"Percentage (%)"}),e.jsx("option",{value:"fixed",children:"Fixed Price (£)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Discount Value *"}),e.jsx("input",{type:"number",name:"discountValue",value:j.discountValue,onChange:U,placeholder:"percentage"===j.discountType?"0-100":"0.00",min:"0",step:"percentage"===j.discountType?"1":"0.01",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Apply to Product (Optional - Leave empty for all products)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:"Search and select product...",value:j.productId?m.find(e=>e._id===j.productId)?.name||"":h,onChange:e=>{y(e.target.value),b(!0)},onFocus:()=>{b(!0),j.productId&&y("")},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none"}),j.productId&&e.jsx("button",{type:"button",onClick:()=>{v({...j,productId:""}),y("")},className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600",children:"×"}),f&&e.jsxs("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white border border-gray-300 rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-gray-50 border-b px-4 py-2",children:e.jsx("input",{type:"text",placeholder:"Search products...",value:h,onChange:e=>y(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none text-sm",autoFocus:!0})}),e.jsxs("div",{children:[e.jsx("div",{onClick:()=>{v({...j,productId:""}),y(""),b(!1)},className:"px-4 py-2 hover:bg-gray-100 cursor-pointer text-sm text-gray-600",children:"All Products"}),Array.isArray(m)&&m.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())).map(t=>e.jsx("div",{onClick:()=>{v({...j,productId:t._id}),y(""),b(!1)},className:"px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-900 border-b last:border-b-0",children:t.name},t._id)),Array.isArray(m)&&0===m.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())).length&&e.jsx("div",{className:"px-4 py-3 text-center text-sm text-gray-500",children:"No products found"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Valid From"}),e.jsx("input",{type:"date",name:"validFrom",value:j.validFrom,onChange:U,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Valid Until"}),e.jsx("input",{type:"date",name:"validUntil",value:j.validUntil,onChange:U,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Max Uses (Leave empty for unlimited)"}),e.jsx("input",{type:"number",name:"maxUses",value:j.maxUses,onChange:U,placeholder:"e.g., 100",min:"1",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Minimum Order Value (£)"}),e.jsx("input",{type:"number",name:"minimumOrderValue",value:j.minimumOrderValue,onChange:U,placeholder:"0.00",min:"0",step:"0.01",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-800 outline-none"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"isActive",name:"isActive",checked:j.isActive,onChange:U,className:"w-4 h-4 rounded border-gray-300"}),e.jsx("label",{htmlFor:"isActive",className:"ml-3 text-sm font-semibold text-gray-900",children:"Active"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),S()},className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-900 font-semibold hover:bg-gray-50 transition",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-gray-800 hover:bg-black text-white rounded-lg font-semibold transition",children:u?"Update Coupon":"Create Coupon"})]})]})]})})]})},n=()=>e.jsx(s,{activeTab:"coupons",children:e.jsx(l,{})});export{n as default};
